<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…‰å½±ä½œå“é›† V3.2 - åˆ›ä½œè€…å¹³å°</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #FAFAFA;
            --white: #FFFFFF;
            --text: #262626;
            --text-secondary: #8E8E8E;
            --border: #DBDBDB;
            --accent: #3897F0;
            --danger: #ED4956;
            --success: #4CAF50;
            --warning: #FF9500;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
        }
        
        .phone-frame {
            max-width: 414px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* é¡µé¢ */
        .page {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
            animation: fadeIn 0.3s ease;
        }
        
        .page.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å¯¼èˆªæ  */
        .nav-header {
            position: sticky;
            top: 0;
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
        }
        
        .nav-title {
            font-size: 17px;
            font-weight: 600;
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 414px;
            display: flex;
            justify-content: space-around;
            padding: 8px 0 24px;
            background: var(--white);
            border-top: 1px solid var(--border);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px 20px;
            cursor: pointer;
            opacity: 0.4;
            transition: opacity 0.2s;
        }
        
        .nav-item.active { opacity: 1; }
        
        .nav-item svg {
            width: 24px;
            height: 24px;
        }
        
        /* æŒ‰é’® */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn:active { transform: scale(0.96); }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        /* æ ‡ç­¾ */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-pending { background: #FFF3E0; color: #F57C00; }
        .badge-confirmed { background: #E3F2FD; color: #1976D2; }
        .badge-shooting { background: #F3E5F5; color: #7B1FA2; }
        .badge-review { background: #E8EAF6; color: #3F51B5; }
        .badge-completed { background: #E8F5E9; color: #388E3C; }
        .badge-cancelled { background: #F5F5F5; color: #616161; }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 14px 24px;
            background: rgba(0,0,0,0.8);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            z-index: 2000;
            display: none;
        }
        
        .toast.show { display: block; }

        /* ========== ç™»å½•å¼¹å±‚æ ·å¼ ========== */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .login-modal.show { display: flex; }

        .login-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .login-container {
            position: relative;
            width: 100%;
            max-width: 380px;
            max-height: 90vh;
            margin: 20px;
            background: white;
            border-radius: 24px;
            padding: 32px 24px;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            animation: loginSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes loginSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .login-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s;
        }

        .login-close:hover { color: var(--text); }

        .login-close svg { width: 20px; height: 20px; }

        .login-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .login-logo {
            margin-bottom: 16px;
        }

        .login-logo svg {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .login-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .login-tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .login-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
            font-weight: 600;
        }

        .login-form {
            display: none;
        }

        .login-form.active { display: block; }

        .input-group {
            position: relative;
            margin-bottom: 16px;
        }

        .input-group input {
            width: 100%;
            padding: 14px 16px;
            padding-left: 56px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .input-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(56, 151, 240, 0.1);
        }

        .input-prefix {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 15px;
            color: var(--text);
            font-weight: 500;
        }

        .input-group input:not([type="password"]) {
            padding-left: 56px;
        }

        .code-input-group {
            display: flex;
            gap: 12px;
        }

        .code-input-group input {
            flex: 1;
            padding-left: 16px;
        }

        .get-code-btn {
            padding: 14px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            color: var(--accent);
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .get-code-btn:hover:not(:disabled) {
            background: rgba(56, 151, 240, 0.05);
        }

        .get-code-btn:disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .remember-me input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--accent);
        }

        .forgot-password {
            font-size: 13px;
            color: var(--accent);
            cursor: pointer;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .wechat-login {
            text-align: center;
            padding: 20px 0;
        }

        .wechat-icon {
            margin-bottom: 16px;
        }

        .wechat-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .wechat-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .wechat-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #07C160;
            width: auto;
            padding: 12px 32px;
        }

        .wechat-btn:hover {
            background: #06AD56;
            box-shadow: 0 6px 20px rgba(7, 193, 96, 0.4);
        }

        .login-register {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .login-register span {
            color: var(--accent);
            cursor: pointer;
            font-weight: 600;
        }

        .login-privacy {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin-top: 20px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .login-privacy input[type="checkbox"] {
            width: 14px;
            height: 14px;
            accent-color: var(--accent);
        }

        .privacy-link {
            color: var(--accent);
            cursor: pointer;
        }

        /* ç”¨æˆ·å¤´åƒæ˜¾ç¤ºç™»å½•çŠ¶æ€ */
        .logged-in-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 18px;
            height: 18px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        .logged-in-badge svg {
            width: 10px;
            height: 10px;
            fill: white;
        }

        /* è®¾ç½®é¡µé¢æ ·å¼ */
        .settings-section {
            padding: 20px 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .settings-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }
        
        .settings-item-text {
            font-size: 15px;
        }
        
        .settings-item-value {
            font-size: 14px;
            color: var(--text-secondary);
        }

    </style>
</head>
<body>
    <div class="phone-frame">
        <!-- ========== Tab 1: æˆ‘çš„åç‰‡ ========== -->
        <div id="page-discover" class="page active">
            <!-- ä¸ªäººåç‰‡ -->
            <div class="business-card">
                <div class="card-header">
                    <img class="card-avatar" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face" alt="æ‘„å½±å¸ˆå¤´åƒ">
                    <div class="card-info">
                        <h2>æ— æ‚¦</h2>
                        <div class="card-title">PORTRAIT PHOTOGRAPHER</div>
                    </div>
                </div>

                <div class="card-signature">
                    "ç”¨é•œå¤´è®°å½•ä¸œæ–¹å¥³æ€§çš„ç‹¬ç‰¹æ°”è´¨ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯æ—¶å…‰çš„è‰ºæœ¯"
                </div>

                <div class="card-contact">
                    <button class="card-contact-btn" onclick="showContactModal('æ—æ‚¦', 'linyue_photo')">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        å¾®ä¿¡å’¨è¯¢
                    </button>
                    <button class="card-contact-btn" onclick="callPhone()">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        ç”µè¯å’¨è¯¢
                    </button>
                </div>
            </div>

        <!-- æœç´¢æ  -->
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="æœç´¢ä½œå“ã€é£æ ¼..." onkeypress="if(event.key==='Enter'){performSearch()}">
            <button class="search-btn" onclick="performSearch()">æœç´¢</button>
        </div>

        <!-- é£æ ¼ç­›é€‰ -->
        <div class="style-filter-section">
            <div class="style-filter-header">
                <span class="style-filter-title">ä½œå“é£æ ¼</span>
                <span class="style-filter-clear" onclick="clearStyleFilter()">æ¸…é™¤ç­›é€‰</span>
            </div>
            <div class="style-filter-tags">
                <div class="style-filter-tag active" onclick="filterByStyle('all', this)">å…¨éƒ¨ä½œå“<span class="count">12</span></div>
                <div class="style-filter-tag" onclick="filterByStyle('æ¸…æ–°', this)">æ¸…æ–°è‡ªç„¶<span class="count">4</span></div>
                <div class="style-filter-tag" onclick="filterByStyle('å¤å¤', this)">å¤å¤èƒ¶ç‰‡<span class="count">3</span></div>
                <div class="style-filter-tag" onclick="filterByStyle('æƒ…ç»ª', this)">æƒ…ç»ªäººåƒ<span class="count">3</span></div>
                <div class="style-filter-tag" onclick="filterByStyle('å¤é£', this)">å¤é£æ±‰æœ<span class="count">2</span></div>
            </div>
        </div>

        <!-- ä½œå“é›†è¡Œå¼å±•ç¤º -->
        <div class="portfolio-rows" id="portfolio-rows"></div>

        <!-- åº•éƒ¨é¢„çº¦æŒ‰é’® -->
            <div style="padding: 24px 16px 100px;">
                <button class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 16px; border-radius: 12px;" onclick="showBookingModal('æ—æ‚¦')">
                    é¢„çº¦æ‹æ‘„
                </button>
            <div style="text-align: center; margin-top: 12px; font-size: 12px; color: var(--text-secondary);">
                ä»·æ ¼å’¨è¯¢è¯·æ·»åŠ å¾®ä¿¡æ²Ÿé€š
            </div>
        </div>
        </div>
        
        <!-- ========== Tab 2: ä½œå“ ========== -->
        <div id="page-portfolio" class="page">
            <div class="nav-header">
                <span class="nav-title">æˆ‘çš„ä½œå“</span>
            </div>
            
            <div class="portfolio-header">
                <img class="portfolio-avatar" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face" alt="å¤´åƒ">
                <div class="portfolio-name">æ—æ‚¦</div>
                <div class="portfolio-bio">ç”¨é•œå¤´è®°å½•ä¸œæ–¹å¥³æ€§çš„ç‹¬ç‰¹æ°”è´¨</div>
            </div>
            
            <div class="portfolio-stats">
                <div class="stat-item">
                    <div class="stat-value">128</div>
                    <div class="stat-label">ä½œå“</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">2.3k</div>
                    <div class="stat-label">æ”¶è—</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">56</div>
                    <div class="stat-label">é¢„çº¦</div>
                </div>
            </div>
            
            <div class="upload-area" onclick="showUploadModal()">
                <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <div style="font-size: 15px; font-weight: 500; margin-bottom: 4px;">ä¸Šä¼ æ–°ä½œå“</div>
                <div style="font-size: 12px; color: var(--text-secondary);">ç‚¹å‡»æ·»åŠ ç…§ç‰‡ã€é£æ ¼æ ‡ç­¾å’Œåˆ›ä½œæƒ³æ³•</div>
            </div>
            
            <!-- ä½œå“åˆ†ç±»Tab -->
            <div class="portfolio-section-title">
                æˆ‘çš„ä½œå“
                <span>å…± 9 ç»„ä½œå“</span>
            </div>
            
            <!-- ä½œå“ç½‘æ ¼ -->
            <div class="portfolio-grid" id="portfolio-grid">
                <div class="portfolio-grid-item" onclick="editMyWork(1)">
                    <img src="https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=400&h=400&fit=crop&crop=face" alt="ä½œå“1">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                234
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item multi" onclick="editMyWork(2)">
                    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=400&fit=crop&crop=face" alt="ä½œå“2">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                567
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item" onclick="editMyWork(3)">
                    <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?w=400&h=400&fit=crop&crop=face" alt="ä½œå“3">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                189
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item" onclick="editMyWork(4)">
                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop&crop=face" alt="ä½œå“4">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                445
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item multi" onclick="editMyWork(5)">
                    <img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400&h=400&fit=crop&crop=face" alt="ä½œå“5">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                892
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item" onclick="editMyWork(6)">
                    <img src="https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?w=400&h=400&fit=crop&crop=face" alt="ä½œå“6">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                123
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item" onclick="editMyWork(7)">
                    <img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400&h=400&fit=crop&crop=face" alt="ä½œå“7">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                678
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item multi" onclick="editMyWork(8)">
                    <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&h=400&fit=crop&crop=face" alt="ä½œå“8">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                334
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portfolio-grid-item" onclick="editMyWork(9)">
                    <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=400&h=400&fit=crop&crop=face" alt="ä½œå“9">
                    <div class="portfolio-grid-overlay">
                        <div class="portfolio-grid-stats">
                            <div class="portfolio-grid-stat">
                                <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                556
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ========== Tab 3: é¢„çº¦ ========== -->
        <div id="page-booking" class="page">
            <div class="nav-header">
                <span class="nav-title">é¢„çº¦ä¸­å¿ƒ</span>
            </div>
            
            <div class="booking-tabs">
                <div class="booking-tab active" onclick="switchBookingTab('sent')">æˆ‘å‘å‡ºçš„</div>
                <div class="booking-tab" onclick="switchBookingTab('received')">
                    æˆ‘æ”¶åˆ°çš„
                    <span class="tab-badge">3</span>
                </div>
            </div>
            
            <div class="booking-status-tabs" id="booking-status-tabs">
                <div class="booking-status-tab active" onclick="filterBookingStatus('all')">å…¨éƒ¨</div>
                <div class="booking-status-tab" onclick="filterBookingStatus('pending')">å¾…ç¡®è®¤</div>
                <div class="booking-status-tab" onclick="filterBookingStatus('confirmed')">å·²ç¡®è®¤</div>
                <div class="booking-status-tab" onclick="filterBookingStatus('shooting')">æ‹æ‘„ä¸­</div>
                <div class="booking-status-tab" onclick="filterBookingStatus('review')">å¾…è¯„ä»·</div>
                <div class="booking-status-tab" onclick="filterBookingStatus('completed')">å·²å®Œæˆ</div>
                <div class="booking-status-tab" onclick="filterBookingStatus('cancelled')">å·²å–æ¶ˆ</div>
            </div>
            
            <!-- æˆ‘å‘å‡ºçš„é¢„çº¦ -->
            <div id="booking-sent" class="booking-section">
                <div class="booking-card" data-status="pending">
                    <div class="booking-card-header">
                        <div class="booking-user">
                            <div class="booking-avatar">ğŸ“·</div>
                            <div class="booking-info">
                                <h4>æ—æ‚¦</h4>
                                <p>æ‘„å½±å¸ˆ</p>
                            </div>
                        </div>
                        <span class="badge badge-pending">å¾…ç¡®è®¤</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>æœŸæœ›æ—¶é—´ï¼š2024å¹´2æœˆ15æ—¥</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                        </svg>
                        <span>æ‹æ‘„ç±»å‹ï¼šä¸ªäººå†™çœŸ</span>
                    </div>
                    <div class="booking-photos">
                        <img class="booking-photo" src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=100&h=100&fit=crop" alt="">
                        <img class="booking-photo" src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=100&h=100&fit=crop" alt="">
                    </div>
                    <div class="booking-actions">
                        <button class="booking-action-btn danger" onclick="cancelBooking()">å–æ¶ˆé¢„çº¦</button>
                        <button class="booking-action-btn secondary" onclick="viewBookingDetail('sent', 'pending')">æŸ¥çœ‹è¯¦æƒ…</button>
                    </div>
                </div>
                
                <div class="booking-card" data-status="confirmed">
                    <div class="booking-card-header">
                        <div class="booking-user">
                            <div class="booking-avatar" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">ğŸ“·</div>
                            <div class="booking-info">
                                <h4>æ—æ‚¦</h4>
                                <p>æ‘„å½±å¸ˆ</p>
                            </div>
                        </div>
                        <span class="badge badge-confirmed">å·²ç¡®è®¤</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>æ‹æ‘„æ—¶é—´ï¼š2024å¹´2æœˆ20æ—¥ ä¸‹åˆ</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span>åœ°ç‚¹ï¼šä¸Šæµ·æ³•ç§Ÿç•Œ</span>
                    </div>
                    <div class="booking-actions">
                        <button class="booking-action-btn secondary" onclick="showContactModal('Lisa Photography', 'lisa_photo_2024')">è”ç³»æ‘„å½±å¸ˆ</button>
                        <button class="booking-action-btn confirm" onclick="viewBookingDetail('sent', 'confirmed')">æŸ¥çœ‹è¯¦æƒ…</button>
                    </div>
                </div>
            </div>
            
            <!-- æˆ‘æ”¶åˆ°çš„é¢„çº¦ -->
            <div id="booking-received" class="booking-section" style="display: none;">
                <div class="booking-card" data-status="pending">
                    <div class="booking-card-header">
                        <div class="booking-user">
                            <div class="booking-avatar">å°</div>
                            <div class="booking-info">
                                <h4>å°é›¨</h4>
                                <p>2å°æ—¶å‰</p>
                            </div>
                        </div>
                        <span class="badge badge-pending">å¾…ç¡®è®¤</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>æœŸæœ›æ—¶é—´ï¼š2024å¹´2æœˆ15æ—¥</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                        </svg>
                        <span>ä¸ªäººå†™çœŸ Â· å–œæ¬¢å¤å¤èƒ¶ç‰‡é£æ ¼</span>
                    </div>
                    <div class="booking-photos">
                        <img class="booking-photo" src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=100&h=100&fit=crop" alt="">
                        <img class="booking-photo" src="https://images.unsplash.com/photo-1509631179647-0177331693ae?w=100&h=100&fit=crop" alt="">
                    </div>
                    <div class="booking-actions">
                        <button class="booking-action-btn secondary" onclick="chatWithClient()">æ²Ÿé€š</button>
                        <button class="booking-action-btn danger" onclick="rejectBooking()">å©‰æ‹’</button>
                        <button class="booking-action-btn confirm" onclick="confirmBooking()">ç¡®è®¤é¢„çº¦</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ========== Tab 4: æˆ‘çš„ ========== -->
        <div id="page-me" class="page">
            <div class="profile-header" onclick="showUserProfile()" style="cursor: pointer;">
                <img class="profile-avatar-large" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face" alt="å¤´åƒ">
                <div class="profile-name-large">${DataManager.isLoggedIn() ? (DataManager.getCurrentUser()?.nickname || 'ç”¨æˆ·') : 'ç‚¹å‡»ç™»å½•'}</div>
                <div class="profile-handle">${DataManager.isLoggedIn() ? (DataManager.getCurrentUser()?.phone ? 'æ‰‹æœºç”¨æˆ·' : 'å¾®ä¿¡ç”¨æˆ·') : '@guest'}</div>
                <div class="profile-bio">${DataManager.isLoggedIn() ? (DataManager.getCurrentUser()?.bio || '"è®°å½•ç¾å¥½ç”Ÿæ´»"') : '"ç™»å½•åäº«å—æ›´å¤šåŠŸèƒ½"'}</div>
            </div>

            <!-- æœªç™»å½•æ—¶æ˜¾ç¤ºç™»å½•æŒ‰é’® -->
            <div id="login-prompt" style="padding: 0 16px 16px; ${DataManager.isLoggedIn() ? 'display: none;' : ''}">
                <button onclick="showLoginModal()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer;">
                    ç«‹å³ç™»å½•
                </button>
            </div>

            <div class="photographer-mode-card disabled" id="photographer-mode-card" style="${DataManager.isLoggedIn() ? '' : 'opacity: 0.6; pointer-events: none;'}">
                <div class="mode-title">ğŸ“· æ‘„å½±å¸ˆæ¨¡å¼</div>
                <div class="mode-desc" id="mode-desc">
                    å¼€å¯åï¼Œä½ å¯ä»¥ç®¡ç†ä½œå“é›†å¹¶æ¥æ”¶æ‹æ‘„é¢„çº¦
                </div>
                <div class="mode-toggle" id="mode-toggle" onclick="togglePhotographerMode()">
                    <span id="mode-toggle-text">å¼€å¯æ‘„å½±å¸ˆåŠŸèƒ½</span>
                </div>
            </div>

            <div class="menu-list">
                <div class="menu-item" onclick="showUserProfile()">
                    <div class="menu-icon">ğŸ‘¤</div>
                    <div class="menu-text">${DataManager.isLoggedIn() ? 'ä¸ªäººèµ„æ–™' : 'ç™»å½•/æ³¨å†Œ'}</div>
                    <div class="menu-arrow">â€º</div>
                </div>
                <div class="menu-item" onclick="showFavorites()">
                    <div class="menu-icon">â¤ï¸</div>
                    <div class="menu-text">æˆ‘çš„æ”¶è—</div>
                    <div class="menu-arrow">â€º</div>
                </div>
                <div class="menu-item" onclick="showNotificationSettings()">
                    <div class="menu-icon">ğŸ””</div>
                    <div class="menu-text">æ¶ˆæ¯é€šçŸ¥</div>
                    <div class="menu-arrow">â€º</div>
                </div>
                <div class="menu-item" onclick="showPrivacySettings()">
                    <div class="menu-icon">ğŸ”’</div>
                    <div class="menu-text">éšç§è®¾ç½®</div>
                    <div class="menu-arrow">â€º</div>
                </div>
                <div class="menu-item" onclick="showHelpCenter()">
                    <div class="menu-icon">â“</div>
                    <div class="menu-text">å¸®åŠ©ä¸­å¿ƒ</div>
                    <div class="menu-arrow">â€º</div>
                </div>
            </div>

            <div style="padding: 20px; text-align: center;" id="logout-btn-container" style="${DataManager.isLoggedIn() ? '' : 'display: none;'}">
                <button onclick="logout()" class="btn btn-secondary" style="width: 100%;">é€€å‡ºç™»å½•</button>
            </div>
        </div>
        
        <!-- ========== åº•éƒ¨å¯¼èˆª ========== -->
        <div class="bottom-nav" id="bottom-nav">
            <div class="nav-item active" onclick="switchTab('discover')" data-tab="discover">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
            </div>
            <div class="nav-item photographer-only" onclick="switchTab('portfolio')" data-tab="portfolio">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            <div class="nav-item photographer-only" onclick="switchTab('booking')" data-tab="booking">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            <div class="nav-item" onclick="switchTab('me')" data-tab="me">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </div>
        </div>
    </div>
    
    <!-- ========== æ¨¡æ€æ¡† ========== -->
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- ========== ç™»å½•å¼¹å±‚ ========== -->
    <div class="login-modal" id="login-modal">
        <div class="login-overlay" onclick="closeLoginModal()"></div>
        <div class="login-container">
            <!-- å…³é—­æŒ‰é’® -->
            <div class="login-close" onclick="closeLoginModal()">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>

            <!-- æ ‡é¢˜ -->
            <div class="login-header">
                <div class="login-logo">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <circle cx="24" cy="24" r="22" fill="url(#logoGradient)" stroke="none"/>
                        <path d="M16 14 L24 22 L32 14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                        <path d="M16 22 L24 30 L32 22" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea"/>
                                <stop offset="100%" style="stop-color:#764ba2"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1 class="login-title">æ¬¢è¿ç™»å½•</h1>
                <p class="login-subtitle">ç™»å½•åå³å¯æ”¶è—ä½œå“ã€å‘èµ·çº¦æ‹</p>
            </div>

            <!-- ç™»å½•æ–¹å¼åˆ‡æ¢ -->
            <div class="login-tabs">
                <div class="login-tab active" data-tab="phone" onclick="switchLoginTab('phone')">æ‰‹æœºç™»å½•</div>
                <div class="login-tab" data-tab="code" onclick="switchLoginTab('code')">éªŒè¯ç ç™»å½•</div>
                <div class="login-tab" data-tab="wechat" onclick="switchLoginTab('wechat')">å¾®ä¿¡ç™»å½•</div>
            </div>

            <!-- æ‰‹æœºå·ç™»å½•è¡¨å• -->
            <div class="login-form active" id="form-phone">
                <div class="input-group">
                    <div class="input-prefix">+86</div>
                    <input type="tel" id="login-phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxlength="11">
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <div class="login-options">
                    <label class="remember-me">
                        <input type="checkbox" id="remember-me" checked>
                        <span>è®°ä½æˆ‘</span>
                    </label>
                    <span class="forgot-password" onclick="showToast('å¿˜è®°å¯†ç åŠŸèƒ½å¼€å‘ä¸­')">å¿˜è®°å¯†ç ?</span>
                </div>
                <button class="login-btn" onclick="loginWithPhone()">ç™»å½•</button>
            </div>

            <!-- éªŒè¯ç ç™»å½•è¡¨å• -->
            <div class="login-form" id="form-code">
                <div class="input-group">
                    <div class="input-prefix">+86</div>
                    <input type="tel" id="code-phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxlength="11">
                </div>
                <div class="input-group code-input-group">
                    <input type="text" id="verify-code" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6">
                    <button class="get-code-btn" id="get-code-btn" onclick="getVerifyCode()">è·å–éªŒè¯ç </button>
                </div>
                <button class="login-btn" onclick="loginWithCode()">ç™»å½•</button>
            </div>

            <!-- å¾®ä¿¡ç™»å½• -->
            <div class="login-form" id="form-wechat">
                <div class="wechat-login">
                    <div class="wechat-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="#07C160">
                            <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 01.213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 00.167-.054l1.903-1.114a.864.864 0 01.717-.098 10.16 10.16 0 002.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 01-1.162 1.178A1.17 1.17 0 014.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 01-1.162 1.178 1.17 1.17 0 01-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 01.598.082l1.584.926a.272.272 0 00.14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 01-.023-.156.49.49 0 01.201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89l-.406-.033zm-2.635 2.736c.535 0 .969.44.969.982a.976.976 0 01-.969.983.976.976 0 01-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 01-.969.983.976.976 0 01-.969-.983c0-.542.434-.982.969-.982z"/>
                        </svg>
                    </div>
                    <p class="wechat-text">å¾®ä¿¡ä¸€é”®ç™»å½•</p>
                    <p class="wechat-desc">æ¨èå·²æ³¨å†Œç”¨æˆ·ä½¿ç”¨</p>
                    <button class="login-btn wechat-btn" onclick="loginWithWechat()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 01.213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 00.167-.054l1.903-1.114a.864.864 0 01.717-.098 10.16 10.16 0 002.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348z"/>
                        </svg>
                        å¾®ä¿¡æˆæƒç™»å½•
                    </button>
                </div>
            </div>

            <!-- æ³¨å†Œæç¤º -->
            <div class="login-register">
                è¿˜æ²¡æœ‰è´¦å·? <span onclick="showToast('æ³¨å†ŒåŠŸèƒ½å¼€å‘ä¸­')">ç«‹å³æ³¨å†Œ</span>
            </div>

            <!-- éšç§åè®® -->
            <div class="login-privacy">
                <label>
                    <input type="checkbox" id="agree-privacy" checked>
                    <span>å·²é˜…è¯»å¹¶åŒæ„</span>
                </label>
                <span class="privacy-link" onclick="showPrivacyPolicy()">ã€Šç”¨æˆ·åè®®ã€‹</span>
                <span>å’Œ</span>
                <span class="privacy-link" onclick="showPrivacyPolicy()">ã€Šéšç§æ”¿ç­–ã€‹</span>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯å¼¹å±‚ -->
    <div class="modal-overlay" id="user-modal">
        <div class="modal-content" style="position: relative; height: 100%; max-height: 100vh; border-radius: 0;">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closeUserModal()" style="cursor: pointer;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    <h3 class="modal-title">ä¸ªäººèµ„æ–™</h3>
                </div>
            </div>
            <div class="modal-body" id="user-modal-content" style="padding-bottom: 20px;">
                <!-- ç”¨æˆ·ä¿¡æ¯å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- ç…§ç‰‡è¯¦æƒ…é¡µ -->
    <div class="photo-detail-page" id="photo-detail-page">
        <div class="photo-detail-header">
            <svg class="photo-detail-back" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closePhotoDetail()">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            <div class="photo-detail-user">
                <img class="photo-detail-avatar" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face" alt="">
                <span class="photo-detail-username">æ—æ‚¦</span>
            </div>
            <button class="photo-detail-follow" style="display: none;">å…³æ³¨</button>
        </div>
        <img class="photo-detail-image" id="detail-image" src="" alt="">
        <div class="photo-detail-actions">
            <svg class="photo-detail-action" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="toggleLike()">
                <path id="like-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            <svg class="photo-detail-action" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="showComments()">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            <svg class="photo-detail-action" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="sharePhoto()">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
            </svg>
            <div class="photo-detail-action spacer"></div>
            <svg class="photo-detail-action" id="favorite-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="toggleFavorite()">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
            </svg>
        </div>
        <div class="photo-detail-info">
            <div class="photo-detail-likes" id="detail-likes">0 æ¬¡èµ</div>
            <div class="photo-detail-title" id="detail-title">ä½œå“æ ‡é¢˜</div>
            <div id="detail-styles">
                <span class="photo-detail-style">é£æ ¼</span>
            </div>
            <div class="photo-detail-notes" id="detail-notes">
                è¿™å¼ ç…§ç‰‡æ‹æ‘„äºä¸Šæµ·çš„æ³•ç§Ÿç•Œï¼Œä½¿ç”¨äº†æŸ¯è¾¾Portra 400èƒ¶ç‰‡ã€‚åˆåçš„é˜³å…‰é€è¿‡æ¢§æ¡æ ‘å¶æ´’åœ¨è„¸ä¸Šï¼Œå½¢æˆäº†è‡ªç„¶çš„å…‰å½±æ•ˆæœã€‚
            </div>
            <div class="photo-detail-gear">
                <div class="photo-detail-gear-title">ğŸ“· æ‹æ‘„å‚æ•°</div>
                <div>ç›¸æœºï¼šCanon EOS R5 | é•œå¤´ï¼šRF 85mm f/1.2L</div>
                <div>å…‰åœˆï¼šf/1.4 | å¿«é—¨ï¼š1/500s | ISOï¼š100</div>
                <div>åæœŸï¼šLightroomè°ƒè‰²ï¼Œå¢åŠ äº†é¢—ç²’æ„Ÿå’Œæš—è§’</div>
            </div>
            <div class="photo-detail-date">2024å¹´2æœˆ1æ—¥</div>
        </div>
        <div style="position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 414px; padding: 12px 16px; background: white; border-top: 1px solid var(--border);">
            <button class="btn btn-primary" style="width: 100%;" onclick="showBookingModal()">é¢„çº¦æ‹æ‘„</button>
        </div>
    </div>
    
    <!-- å‘èµ·é¢„çº¦å¼¹çª— -->
    <div class="modal-overlay" id="booking-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å‘èµ·é¢„çº¦</h3>
                <svg class="modal-close" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closeBookingModal()">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>
            <div class="modal-body">
                <!-- æ‘„å½±å¸ˆé¢„è§ˆ -->
                <div class="photographer-preview">
                    <img class="photographer-preview-avatar" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face" alt="">
                    <div class="photographer-preview-info">
                        <div class="photographer-preview-name">æ—æ‚¦</div>
                        <div class="photographer-preview-style">æ“…é•¿ï¼šæ¸…æ–°è‡ªç„¶ã€å¤å¤èƒ¶ç‰‡ã€å¤é£æ±‰æœ</div>
                    </div>
                </div>
                
                <div class="booking-form-group">
                    <label class="booking-form-label">æ‹æ‘„ç±»å‹ <span class="required">*</span></label>
                    <div class="booking-type-options">
                        <div class="booking-type-option" onclick="selectBookingType(this)">ä¸ªäººå†™çœŸ</div>
                        <div class="booking-type-option" onclick="selectBookingType(this)">æƒ…ä¾£ç…§</div>
                        <div class="booking-type-option" onclick="selectBookingType(this)">æ¯•ä¸šç…§</div>
                        <div class="booking-type-option" onclick="selectBookingType(this)">é—ºèœœç…§</div>
                        <div class="booking-type-option" onclick="selectBookingType(this)">å•†ä¸šæ‹æ‘„</div>
                        <div class="booking-type-option" onclick="selectBookingType(this)">å…¶ä»–</div>
                    </div>
                </div>
                
                <div class="booking-form-group">
                    <label class="booking-form-label">æœŸæœ›æ‹æ‘„æ—¶é—´ <span class="required">*</span></label>
                    <div class="date-time-picker">
                        <input type="date" class="booking-form-input" id="booking-date">
                        <select class="booking-form-select" id="booking-time">
                            <option value="">é€‰æ‹©æ—¶æ®µ</option>
                            <option value="morning">ä¸Šåˆ (9:00-12:00)</option>
                            <option value="afternoon">ä¸‹åˆ (14:00-17:00)</option>
                            <option value="evening">å‚æ™š (17:00-19:00)</option>
                            <option value="night">æ™šä¸Š (19:00-21:00)</option>
                        </select>
                    </div>
                </div>
                
                <div class="booking-form-group">
                    <label class="booking-form-label">æ‹æ‘„åœ°ç‚¹ <span class="hint">ï¼ˆå¯é€‰ï¼‰</span></label>
                    <input type="text" class="booking-form-input" id="booking-location" placeholder="ä¾‹å¦‚ï¼šä¸Šæµ·æ³•ç§Ÿç•Œã€å¤–æ»©">
                </div>
                
                <div class="booking-form-group">
                    <label class="booking-form-label">æœŸæœ›é£æ ¼ <span class="hint">ï¼ˆå¯é€‰ï¼‰</span></label>
                    <input type="text" class="booking-form-input" id="booking-style" placeholder="ä¾‹å¦‚ï¼šå¤å¤èƒ¶ç‰‡ã€è‡ªç„¶å…‰">
                </div>
                
                <div class="booking-form-group">
                    <label class="booking-form-label">å¤‡æ³¨è¯´æ˜ <span class="hint">ï¼ˆå¯é€‰ï¼‰</span></label>
                    <textarea class="booking-form-textarea" id="booking-notes" placeholder="æè¿°ä½ çš„æ‹æ‘„éœ€æ±‚ã€æœŸæœ›æ•ˆæœã€ç‰¹æ®Šè¦æ±‚ç­‰..."></textarea>
                </div>
                
                <div class="booking-form-group">
                    <label class="booking-form-label">è”ç³»ç”µè¯ <span class="required">*</span></label>
                    <input type="tel" class="booking-form-input" id="booking-phone" placeholder="è¯·è¾“å…¥ä½ çš„æ‰‹æœºå·ç ">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeBookingModal()">å–æ¶ˆ</button>
                <button class="modal-btn primary" onclick="submitBooking()">å‘é€é¢„çº¦</button>
            </div>
        </div>
    </div>
    
    <!-- ä¸Šä¼ ä½œå“å¼¹çª—ï¼ˆå°ç¨‹åºé£æ ¼ï¼‰ -->
    <div class="modal-overlay" id="upload-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ä¸Šä¼ æ–°ä½œå“</h3>
                <svg class="modal-close" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closeUploadModal()">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>
            <div class="modal-body">
                <!-- ç…§ç‰‡ä¸Šä¼  -->
                <div class="upload-form-group">
                    <label class="upload-form-label">ç…§ç‰‡ <span class="required">*</span></label>
                    <div class="upload-photo-section">
                        <div class="upload-photo-item" onclick="selectUploadPhoto()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span>æ·»åŠ ç…§ç‰‡</span>
                        </div>
                    </div>
                </div>
                
                <!-- ä½œå“æ ‡é¢˜ -->
                <div class="upload-form-group">
                    <label class="upload-form-label">æ ‡é¢˜ <span class="required">*</span></label>
                    <input type="text" class="upload-form-input" id="upload-title" placeholder="ç»™ä½ çš„ä½œå“èµ·ä¸ªåå­—">
                </div>
                
                <!-- é£æ ¼æ ‡ç­¾ -->
                <div class="upload-form-group">
                    <label class="upload-form-label">é£æ ¼æ ‡ç­¾</label>
                    
                    <div class="style-selector">
                        <div class="style-selector-title">å¸¸ç”¨æ ‡ç­¾ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰</div>
                        <div class="style-options">
                            <div class="style-option" onclick="toggleStyleOption(this)">å¤å¤èƒ¶ç‰‡</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">æ—¥ç³»æ¸…æ–°</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">æƒ…ç»ªäººåƒ</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">æ—¶å°šå¤§ç‰‡</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">è¡—æ‹çºªå®</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">é»‘ç™½æ‘„å½±</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">è‡ªç„¶å…‰</div>
                            <div class="style-option" onclick="toggleStyleOption(this)">å¤œæ™¯</div>
                        </div>
                    </div>
                    
                    <div class="style-custom-input">
                        <input type="text" id="custom-style-input" placeholder="è‡ªå®šä¹‰æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ ">
                        <button onclick="addCustomStyle()">æ·»åŠ </button>
                    </div>
                    
                    <div class="selected-styles" id="selected-styles">
                        <!-- å·²é€‰æ ‡ç­¾å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                </div>
                
                <!-- åˆ›ä½œæƒ³æ³• -->
                <div class="upload-form-group">
                    <label class="upload-form-label">åˆ›ä½œæƒ³æ³•</label>
                    <textarea class="upload-form-textarea" id="upload-notes" placeholder="åˆ†äº«è¿™å¼ ç…§ç‰‡èƒŒåçš„æ•…äº‹ã€æ‹æ‘„å¿ƒå¾—ã€åˆ›ä½œç†å¿µ..."></textarea>
                </div>
                
                <!-- æ‹æ‘„å‚æ•° -->
                <div class="upload-form-group">
                    <label class="upload-form-label">æ‹æ‘„è®¾å¤‡</label>
                    <div class="gear-section">
                        <div class="gear-row">
                            <input type="text" class="gear-input" id="upload-camera" placeholder="ç›¸æœºå‹å·">
                            <input type="text" class="gear-input" id="upload-lens" placeholder="é•œå¤´">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeUploadModal()">å–æ¶ˆ</button>
                <button class="modal-btn primary" onclick="submitUpload()">å‘å¸ƒä½œå“</button>
            </div>
        </div>
    </div>
    
    <!-- è”ç³»æ‘„å½±å¸ˆå¼¹çª— -->
    <div class="modal-overlay" id="contact-modal" style="align-items: center; justify-content: center;">
        <div class="modal-content" style="position: relative; border-radius: 16px; max-width: 340px; left: auto; transform: none; bottom: auto;">
            <div class="contact-card">
                <img class="contact-avatar" id="contact-avatar" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face" alt="">
                <div class="contact-name" id="contact-name">æ—æ‚¦</div>
                <div class="contact-role">å¾®ä¿¡å·</div>
                <div class="wechat-id">
                    <div class="wechat-label">å¤åˆ¶å¾®ä¿¡å·æ·»åŠ å¥½å‹</div>
                    <div class="wechat-value" id="wechat-id">wechat_id_123</div>
                </div>
                <button class="copy-btn" onclick="copyWechatId()">å¤åˆ¶å¾®ä¿¡å·</button>
            </div>
        </div>
    </div>
    
    <!-- å®Œæˆæ‹æ‘„å¼¹çª— -->
    <div class="modal-overlay" id="complete-modal" style="align-items: center; justify-content: center;">
        <div class="modal-content" style="position: relative; border-radius: 16px; max-width: 340px; left: auto; transform: none; bottom: auto; margin: 20px;">
            <div class="complete-modal-content">
                <div class="complete-icon">âœ“</div>
                <div class="complete-title">æ‹æ‘„å®Œæˆï¼</div>
                <div class="complete-desc">
                    æ­å–œä½ å®Œæˆäº†ä¸€æ¬¡æ‹æ‘„ï¼æ¥ä¸‹æ¥è¯·æŒ‰ä»¥ä¸‹æµç¨‹æ“ä½œï¼š
                </div>
                <div class="complete-next-steps">
                    <h4>ğŸ“‹ åç»­æ­¥éª¤</h4>
                    <ul>
                        <li>72å°æ—¶å†…äº¤ä»˜ç²¾ä¿®ç…§ç‰‡ï¼ˆå»ºè®®15-30å¼ ï¼‰</li>
                        <li>ä¸Šä¼ æˆç‰‡åˆ°ä½œå“é›†ï¼Œæ ‡è®°æ‹æ‘„å¯¹è±¡</li>
                        <li>æé†’å¯¹æ–¹ç¡®è®¤æ”¶åˆ°æˆç‰‡å¹¶è¯„ä»·</li>
                        <li>åŠæ—¶å›å¤å¯¹æ–¹çš„ä»»ä½•é—®é¢˜</li>
                    </ul>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="closeCompleteModal()">æˆ‘çŸ¥é“äº†</button>
            </div>
        </div>
    </div>
    
    <!-- æ‘„å½±å¸ˆæ¨¡å¼æç¤ºå¼¹çª— -->
    <div class="mode-notice" id="mode-notice">
        <div class="mode-notice-content">
            <div class="mode-notice-icon">ğŸ“·</div>
            <div class="mode-notice-title">åŠŸèƒ½æœªå¼€å¯</div>
            <div class="mode-notice-desc">
                "æˆ‘çš„ä½œå“"å’Œ"é¢„çº¦ä¸­å¿ƒ"åŠŸèƒ½éœ€è¦å¼€å¯æ‘„å½±å¸ˆæ¨¡å¼æ‰èƒ½ä½¿ç”¨ã€‚
            </div>
            <button class="mode-notice-btn" onclick="closeModeNotice()">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <!-- é¢„çº¦è¯¦æƒ…å¼¹çª— -->
    <div class="modal-overlay" id="booking-detail-modal">
        <div class="modal-content" style="max-height: 85vh;">
            <div class="modal-header">
                <h3 class="modal-title">é¢„çº¦è¯¦æƒ…</h3>
                <svg class="modal-close" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closeBookingDetailModal()">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>
            <div class="modal-body" id="booking-detail-content">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘ä½œå“å¼¹çª— -->
    <div class="modal-overlay" id="edit-work-modal">
        <div class="modal-content" style="max-height: 90vh;">
            <div class="modal-header">
                <h3 class="modal-title">ç¼–è¾‘ä½œå“</h3>
                <svg class="modal-close" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closeEditWorkModal()">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </div>
            <div class="modal-body" id="edit-work-content" style="padding: 0;">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeEditWorkModal()">å–æ¶ˆ</button>
                <button class="modal-btn primary" onclick="saveWork()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®é¡µé¢å¼¹çª— -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content" style="position: relative; height: 100%; max-height: 100vh; border-radius: 0;">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" onclick="closeSettingsModal()" style="cursor: pointer;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    <h3 class="modal-title" id="settings-title">è®¾ç½®</h3>
                </div>
            </div>
            <div class="modal-body" id="settings-content" style="padding-bottom: 20px;">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
        </div>
    </div>

    <script>
        // ========== æ•°æ®å­˜å‚¨ç®¡ç†å™¨ ==========
        const DataManager = {
            STORAGE_KEYS: {
                PORTFOLIO: 'gy_portfolio',
                BOOKINGS_SENT: 'gy_bookings_sent',
                BOOKINGS_RECEIVED: 'gy_bookings_received',
                USER_PROFILE: 'gy_user_profile',
                PHOTOGRAPHER_MODE: 'gy_photographer_mode',
                UPLOADED_PHOTOS: 'gy_uploaded_photos',
                LIKES: 'gy_likes',                    // ç‚¹èµæ•°æ®
                FAVORITES: 'gy_favorites',            // æ”¶è—æ•°æ®
                COMMENTS: 'gy_comments',              // è¯„è®ºæ•°æ®
                BROWSING_HISTORY: 'gy_browsing_history', // æµè§ˆå†å²
                NOTIFICATIONS: 'gy_notifications'     // é€šçŸ¥æ¶ˆæ¯
            },

            // åˆå§‹åŒ–é»˜è®¤æ•°æ®
            init() {
                if (!localStorage.getItem(this.STORAGE_KEYS.PORTFOLIO)) {
                    localStorage.setItem(this.STORAGE_KEYS.PORTFOLIO, JSON.stringify([
                        {
                            id: 1,
                            title: 'æ¸…æ–°æ—¥ç³» | çª—è¾¹å°‘å¥³',
                            style: 'æ¸…æ–°',
                            count: 3,
                            photos: [
                                { id: 101, src: 'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=400&h=500&fit=crop&crop=face', size: 'large', desc: 'è‡ªç„¶å…‰ä¸‹çš„æ¸©æŸ”' },
                                { id: 102, src: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'åˆåæ—¶å…‰' },
                                { id: 103, src: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'æ¬é™æ—¶åˆ»' }
                            ]
                        },
                        {
                            id: 2,
                            title: 'å¤å¤èƒ¶ç‰‡ | è€ä¸Šæµ·é£æƒ…',
                            style: 'å¤å¤',
                            count: 4,
                            photos: [
                                { id: 201, src: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=500&fit=crop&crop=face', size: 'large', desc: 'æ——è¢ä½³äºº' },
                                { id: 202, src: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'æ—§æ—¶å…‰' },
                                { id: 203, src: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'å¤å¤éŸµå‘³' },
                                { id: 204, src: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'èƒ¶ç‰‡è´¨æ„Ÿ' }
                            ]
                        },
                        {
                            id: 3,
                            title: 'æƒ…ç»ªäººåƒ | å…‰å½±ä¹‹é—´',
                            style: 'æƒ…ç»ª',
                            count: 3,
                            photos: [
                                { id: 301, src: 'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?w=400&h=500&fit=crop&crop=face', size: 'large', desc: 'æ€ç»ªä¸‡åƒ' },
                                { id: 302, src: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'å…‰å½±äº¤é”™' },
                                { id: 303, src: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'é™è°§æ—¶åˆ»' }
                            ]
                        },
                        {
                            id: 4,
                            title: 'å¤é£æ±‰æœ | ä¸œæ–¹ç¾å­¦',
                            style: 'å¤é£',
                            count: 3,
                            photos: [
                                { id: 401, src: 'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=400&h=500&fit=crop&crop=face', size: 'large', desc: 'å¤å…¸éŸµå‘³' },
                                { id: 402, src: 'https://images.unsplash.com/photo-1469334031218-e382a71b716b?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'æ¸©å©‰å¦‚ç”»' },
                                { id: 403, src: 'https://images.unsplash.com/photo-1496440737103-cd596325d314?w=300&h=400&fit=crop&crop=face', size: 'medium', desc: 'æ¸…é›…è„±ä¿—' }
                            ]
                        }
                    ]));
                }

                if (!localStorage.getItem(this.STORAGE_KEYS.BOOKINGS_SENT)) {
                    localStorage.setItem(this.STORAGE_KEYS.BOOKINGS_SENT, JSON.stringify([
                        {
                            id: 'BK001',
                            photographerName: 'æ—æ‚¦',
                            type: 'ä¸ªäººå†™çœŸ',
                            date: '2024-02-15',
                            timeSlot: 'afternoon',
                            location: 'ä¸Šæµ·æ³•ç§Ÿç•Œ',
                            style: 'å¤å¤èƒ¶ç‰‡é£æ ¼',
                            notes: 'æƒ³è¦æ‹æ‘„ä¸€ç»„å¤å¤èƒ¶ç‰‡é£æ ¼çš„äººåƒç…§ç‰‡',
                            phone: '138-0000-0000',
                            status: 'pending',
                            photos: ['https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=100&h=100&fit=crop', 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=100&h=100&fit=crop'],
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'BK002',
                            photographerName: 'Lisa Photography',
                            type: 'ä¸ªäººå†™çœŸ',
                            date: '2024-02-20',
                            timeSlot: 'afternoon',
                            location: 'ä¸Šæµ·æ³•ç§Ÿç•Œ',
                            style: 'è‡ªç„¶é£æ ¼',
                            notes: '',
                            phone: '138-0000-0000',
                            status: 'confirmed',
                            photos: [],
                            createdAt: new Date(Date.now() - 86400000).toISOString()
                        }
                    ]));
                }

                if (!localStorage.getItem(this.STORAGE_KEYS.BOOKINGS_RECEIVED)) {
                    localStorage.setItem(this.STORAGE_KEYS.BOOKINGS_RECEIVED, JSON.stringify([
                        {
                            id: 'BK003',
                            clientName: 'å°é›¨',
                            clientAvatar: 'å°',
                            type: 'ä¸ªäººå†™çœŸ',
                            date: '2024-02-15',
                            timeSlot: 'morning',
                            location: '',
                            style: 'å¤å¤èƒ¶ç‰‡é£æ ¼',
                            notes: 'å–œæ¬¢å¤å¤èƒ¶ç‰‡é£æ ¼ï¼Œå¸Œæœ›èƒ½æœ‰é˜³å…‰çš„ä¸‹åˆ',
                            phone: '139-0000-0000',
                            status: 'pending',
                            photos: ['https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=100&h=100&fit=crop', 'https://images.unsplash.com/photo-1509631179647-0177331693ae?w=100&h=100&fit=crop'],
                            createdAt: new Date(Date.now() - 7200000).toISOString()
                        }
                    ]));
                }

                if (!localStorage.getItem(this.STORAGE_KEYS.USER_PROFILE)) {
                    localStorage.setItem(this.STORAGE_KEYS.USER_PROFILE, JSON.stringify({
                        name: 'æ—æ‚¦',
                        handle: '@linyue_photo',
                        bio: '"ç”¨é•œå¤´è®°å½•ä¸œæ–¹å¥³æ€§çš„ç‹¬ç‰¹æ°”è´¨ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯æ—¶å…‰çš„è‰ºæœ¯"',
                        role: 'PORTRAIT PHOTOGRAPHER',
                        city: 'ä¸Šæµ·',
                        styles: 'æ¸…æ–°è‡ªç„¶ã€å¤å¤èƒ¶ç‰‡ã€å¤é£æ±‰æœ',
                        wechat: 'linyue_photo',
                        phone: '13800000000',
                        avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face'
                    }));
                }

                if (!localStorage.getItem(this.STORAGE_KEYS.UPLOADED_PHOTOS)) {
                    localStorage.setItem(this.STORAGE_KEYS.UPLOADED_PHOTOS, JSON.stringify([]));
                }
            },

            // è·å–ä½œå“æ•°æ®
            getPortfolio() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.PORTFOLIO) || '[]');
            },

            // ä¿å­˜ä½œå“æ•°æ®
            savePortfolio(data) {
                localStorage.setItem(this.STORAGE_KEYS.PORTFOLIO, JSON.stringify(data));
            },

            // è·å–æˆ‘å‘å‡ºçš„é¢„çº¦
            getSentBookings() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.BOOKINGS_SENT) || '[]');
            },

            // ä¿å­˜æˆ‘å‘å‡ºçš„é¢„çº¦
            saveSentBookings(data) {
                localStorage.setItem(this.STORAGE_KEYS.BOOKINGS_SENT, JSON.stringify(data));
            },

            // è·å–æˆ‘æ”¶åˆ°çš„é¢„çº¦
            getReceivedBookings() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.BOOKINGS_RECEIVED) || '[]');
            },

            // ä¿å­˜æˆ‘æ”¶åˆ°çš„é¢„çº¦
            saveReceivedBookings(data) {
                localStorage.setItem(this.STORAGE_KEYS.BOOKINGS_RECEIVED, JSON.stringify(data));
            },

            // è·å–ç”¨æˆ·èµ„æ–™
            getUserProfile() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.USER_PROFILE) || '{}');
            },

            // ä¿å­˜ç”¨æˆ·èµ„æ–™
            saveUserProfile(data) {
                localStorage.setItem(this.STORAGE_KEYS.USER_PROFILE, JSON.stringify(data));
            },

            // è·å–ä¸Šä¼ çš„ç…§ç‰‡
            getUploadedPhotos() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.UPLOADED_PHOTOS) || '[]');
            },

            // ä¿å­˜ä¸Šä¼ çš„ç…§ç‰‡
            saveUploadedPhotos(data) {
                localStorage.setItem(this.STORAGE_KEYS.UPLOADED_PHOTOS, JSON.stringify(data));
            },

            // è·å–æ‘„å½±å¸ˆæ¨¡å¼çŠ¶æ€
            getPhotographerMode() {
                return localStorage.getItem(this.STORAGE_KEYS.PHOTOGRAPHER_MODE) === 'true';
            },

            // è®¾ç½®æ‘„å½±å¸ˆæ¨¡å¼çŠ¶æ€
            setPhotographerMode(value) {
                localStorage.setItem(this.STORAGE_KEYS.PHOTOGRAPHER_MODE, value.toString());
            },

            // ========== ç‚¹èµåŠŸèƒ½ ==========
            getLikes() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.LIKES) || '{}');
            },

            saveLikes(data) {
                localStorage.setItem(this.STORAGE_KEYS.LIKES, JSON.stringify(data));
            },

            isLiked(itemId) {
                const likes = this.getLikes();
                return likes[itemId] === true;
            },

            toggleLike(itemId) {
                const likes = this.getLikes();
                likes[itemId] = !likes[itemId];
                this.saveLikes(likes);
                return likes[itemId];
            },

            getLikeCount(itemId) {
                const likes = this.getLikes();
                // è¿”å›æ¨¡æ‹Ÿçš„ç‚¹èµæ•° + å®é™…ç‚¹èµ
                const baseCount = Math.floor(Math.random() * 500) + 100;
                return baseCount + (likes[itemId] ? 1 : 0);
            },

            // ========== æ”¶è—åŠŸèƒ½ ==========
            getFavorites() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.FAVORITES) || '[]');
            },

            saveFavorites(data) {
                localStorage.setItem(this.STORAGE_KEYS.FAVORITES, JSON.stringify(data));
            },

            isFavorite(itemId) {
                const favorites = this.getFavorites();
                return favorites.includes(itemId);
            },

            toggleFavorite(itemId) {
                let favorites = this.getFavorites();
                if (favorites.includes(itemId)) {
                    favorites = favorites.filter(id => id !== itemId);
                    this.saveFavorites(favorites);
                    return false;
                } else {
                    favorites.push(itemId);
                    this.saveFavorites(favorites);
                    return true;
                }
            },

            addFavorite(itemId) {
                const favorites = this.getFavorites();
                if (!favorites.includes(itemId)) {
                    favorites.push(itemId);
                    this.saveFavorites(favorites);
                }
            },

            removeFavorite(itemId) {
                let favorites = this.getFavorites();
                favorites = favorites.filter(id => id !== itemId);
                this.saveFavorites(favorites);
            },

            // ========== è¯„è®ºåŠŸèƒ½ ==========
            getComments(itemId) {
                const allComments = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.COMMENTS) || '{}');
                return allComments[itemId] || [];
            },

            saveComments(itemId, comments) {
                const allComments = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.COMMENTS) || '{}');
                allComments[itemId] = comments;
                localStorage.setItem(this.STORAGE_KEYS.COMMENTS, JSON.stringify(allComments));
            },

            addComment(itemId, comment) {
                const comments = this.getComments(itemId);
                comments.push({
                    id: Utils.generateId('cmt_'),
                    ...comment,
                    createdAt: new Date().toISOString()
                });
                this.saveComments(itemId, comments);
                return comments;
            },

            deleteComment(itemId, commentId) {
                let comments = this.getComments(itemId);
                comments = comments.filter(c => c.id !== commentId);
                this.saveComments(itemId, comments);
            },

            // ========== æµè§ˆå†å² ==========
            getBrowsingHistory() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.BROWSING_HISTORY) || '[]');
            },

            saveBrowsingHistory(data) {
                localStorage.setItem(this.STORAGE_KEYS.BROWSING_HISTORY, JSON.stringify(data));
            },

            addToHistory(item) {
                let history = this.getBrowsingHistory();
                // ç§»é™¤é‡å¤
                history = history.filter(h => h.id !== item.id);
                // æ·»åŠ åˆ°å¼€å¤´
                history.unshift({
                    ...item,
                    viewedAt: new Date().toISOString()
                });
                // åªä¿ç•™æœ€è¿‘50æ¡
                if (history.length > 50) {
                    history = history.slice(0, 50);
                }
                this.saveBrowsingHistory(history);
            },

            clearHistory() {
                localStorage.removeItem(this.STORAGE_KEYS.BROWSING_HISTORY);
            },

            // ========== é€šçŸ¥æ¶ˆæ¯ ==========
            getNotifications() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.NOTIFICATIONS) || '[]');
            },

            saveNotifications(data) {
                localStorage.setItem(this.STORAGE_KEYS.NOTIFICATIONS, JSON.stringify(data));
            },

            addNotification(notification) {
                const notifications = this.getNotifications();
                notifications.unshift({
                    id: Utils.generateId('ntf_'),
                    ...notification,
                    read: false,
                    createdAt: new Date().toISOString()
                });
                this.saveNotifications(notifications);
                return notifications;
            },

            markAsRead(notificationId) {
                const notifications = this.getNotifications();
                const notification = notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = true;
                    this.saveNotifications(notifications);
                }
            },

            markAllAsRead() {
                const notifications = this.getNotifications();
                notifications.forEach(n => n.read = true);
                this.saveNotifications(notifications);
            },

            getUnreadCount() {
                const notifications = this.getNotifications();
                return notifications.filter(n => !n.read).length;
            },

            // ========== ç”¨æˆ·è®¤è¯ç®¡ç† ==========
            getCurrentUser() {
                return JSON.parse(localStorage.getItem('gy_current_user') || 'null');
            },

            setCurrentUser(user) {
                localStorage.setItem('gy_current_user', JSON.stringify(user));
            },

            clearCurrentUser() {
                localStorage.removeItem('gy_current_user');
            },

            isLoggedIn() {
                return !!this.getCurrentUser();
            },

            // ç”¨æˆ·æ³¨å†Œï¼ˆæ¨¡æ‹Ÿï¼‰
            register(userData) {
                const users = JSON.parse(localStorage.getItem('gy_users') || '[]');
                const existing = users.find(u => u.phone === userData.phone);
                if (existing) {
                    return { success: false, message: 'è¯¥æ‰‹æœºå·å·²æ³¨å†Œ' };
                }
                const newUser = {
                    id: Utils.generateId('user_'),
                    ...userData,
                    createdAt: new Date().toISOString(),
                    lastLoginAt: new Date().toISOString()
                };
                users.push(newUser);
                localStorage.setItem('gy_users', JSON.stringify(users));
                return { success: true, user: newUser };
            },

            // ç”¨æˆ·ç™»å½•ï¼ˆæ¨¡æ‹Ÿæ‰‹æœºå·å¯†ç ï¼‰
            loginWithPhone(phone, password) {
                const users = JSON.parse(localStorage.getItem('gy_users') || '[]');
                const user = users.find(u => u.phone === phone && u.password === password);

                if (user) {
                    user.lastLoginAt = new Date().toISOString();
                    localStorage.setItem('gy_users', JSON.stringify(users));
                    this.setCurrentUser(user);
                    return { success: true, user };
                }
                return { success: false, message: 'æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯' };
            },

            // éªŒè¯ç ç™»å½•ï¼ˆæ¨¡æ‹Ÿï¼‰
            loginWithCode(phone, code) {
                // æ¨¡æ‹ŸéªŒè¯ç éªŒè¯ï¼ˆå®é™…åº”ä¸ºæœåŠ¡å™¨éªŒè¯ï¼‰
                const users = JSON.parse(localStorage.getItem('gy_users') || '[]');
                let user = users.find(u => u.phone === phone);

                if (!user) {
                    // æ–°ç”¨æˆ·ï¼Œè‡ªåŠ¨æ³¨å†Œ
                    const result = this.register({
                        phone,
                        nickname: 'ç”¨æˆ·' + phone.slice(-4),
                        avatar: '',
                        password: ''
                    });
                    if (!result.success) {
                        return result;
                    }
                    user = result.user;
                }

                user.lastLoginAt = new Date().toISOString();
                localStorage.setItem('gy_users', JSON.stringify(users));
                this.setCurrentUser(user);
                return { success: true, user };
            },

            // å¾®ä¿¡ç™»å½•ï¼ˆæ¨¡æ‹Ÿï¼‰
            loginWithWechat(wechatData) {
                const users = JSON.parse(localStorage.getItem('gy_users') || '[]');
                let user = users.find(u => u.wechatOpenId === wechatData.openId);

                if (!user) {
                    // æ–°ç”¨æˆ·ï¼Œè‡ªåŠ¨æ³¨å†Œ
                    const result = this.register({
                        phone: '',
                        nickname: wechatData.nickname || 'å¾®ä¿¡ç”¨æˆ·',
                        avatar: wechatData.avatar,
                        wechatOpenId: wechatData.openId,
                        password: ''
                    });
                    if (!result.success) {
                        return result;
                    }
                    user = result.user;
                }

                user.lastLoginAt = new Date().toISOString();
                localStorage.setItem('gy_users', JSON.stringify(users));
                this.setCurrentUser(user);
                return { success: true, user };
            },

            // æ›´æ–°ç”¨æˆ·èµ„æ–™
            updateUserProfile(updates) {
                const user = this.getCurrentUser();
                if (!user) return { success: false, message: 'æœªç™»å½•' };

                const updatedUser = { ...user, ...updates };
                this.setCurrentUser(updatedUser);

                // æ›´æ–°ç”¨æˆ·åˆ—è¡¨
                const users = JSON.parse(localStorage.getItem('gy_users') || '[]');
                const index = users.findIndex(u => u.id === user.id);
                if (index !== -1) {
                    users[index] = updatedUser;
                    localStorage.setItem('gy_users', JSON.stringify(users));
                }

                return { success: true, user: updatedUser };
            },

            // ç™»å‡º
            logout() {
                this.clearCurrentUser();
                showToast('å·²é€€å‡ºç™»å½•');
                updateLoginState();
            },

            // ç”ŸæˆéªŒè¯ç ï¼ˆæ¨¡æ‹Ÿï¼‰
            generateCode() {
                return Math.floor(100000 + Math.random() * 900000).toString();
            },

            // ä¿å­˜éªŒè¯ç 
            saveVerifyCode(phone, code) {
                const codes = JSON.parse(localStorage.getItem('gy_verify_codes') || '{}');
                codes[phone] = {
                    code,
                    expiresAt: Date.now() + 300000 // 5åˆ†é’Ÿè¿‡æœŸ
                };
                localStorage.setItem('gy_verify_codes', JSON.stringify(codes));
            },

            // éªŒè¯éªŒè¯ç 
            verifyCode(phone, code) {
                const codes = JSON.parse(localStorage.getItem('gy_verify_codes') || '{}');
                const record = codes[phone];
                if (!record) return false;
                if (Date.now() > record.expiresAt) {
                    delete codes[phone];
                    localStorage.setItem('gy_verify_codes', JSON.stringify(codes));
                    return false;
                }
                return record.code === code;
            },

            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            clearAll() {
                Object.values(this.STORAGE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
            }
        };

        // ========== ç”¨æˆ·çŠ¶æ€ç®¡ç† ==========
        let currentUser = DataManager.getCurrentUser();
        let isLoggedIn = DataManager.isLoggedIn();
            // ç”Ÿæˆå”¯ä¸€ID
            generateId(prefix = '') {
                return prefix + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
            },

            // æ ¼å¼åŒ–æ—¥æœŸ
            formatDate(dateStr) {
                const date = new Date(dateStr);
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                return `${year}å¹´${month}æœˆ${day}æ—¥`;
            },

            // æ ¼å¼åŒ–æ—¶é—´
            formatTimeAgo(dateStr) {
                const now = new Date();
                const date = new Date(dateStr);
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (minutes < 1) return 'åˆšåˆš';
                if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
                if (hours < 24) return `${hours}å°æ—¶å‰`;
                if (days < 7) return `${days}å¤©å‰`;
                return this.formatDate(dateStr);
            },

            // æ—¶æ®µæ˜¾ç¤ºæ–‡å­—
            getTimeSlotText(slot) {
                const texts = {
                    'morning': 'ä¸Šåˆ (9:00-12:00)',
                    'afternoon': 'ä¸‹åˆ (14:00-17:00)',
                    'evening': 'å‚æ™š (17:00-19:00)',
                    'night': 'æ™šä¸Š (19:00-21:00)'
                };
                return texts[slot] || slot;
            },

            // éªŒè¯æ‰‹æœºå·
            validatePhone(phone) {
                return /^1[3-9]\d{9}$/.test(phone.replace(/-/g, ''));
            },

            // å›¾ç‰‡å‹ç¼©ï¼ˆä½¿ç”¨canvasï¼‰
            async compressImage(file, maxWidth = 800, quality = 0.8) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;

                            if (width > maxWidth) {
                                height = (height * maxWidth) / width;
                                width = maxWidth;
                            }

                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);

                            canvas.toBlob((blob) => {
                                resolve(URL.createObjectURL(blob));
                            }, 'image/jpeg', quality);
                        };
                        img.onerror = reject;
                        img.src = e.target.result;
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },

            // æ–‡ä»¶è½¬Base64
            fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },

            // ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆåªä¿å­˜Base64ï¼Œé™åˆ¶å¤§å°ï¼‰
            async saveImageToStorage(file) {
                try {
                    // å‹ç¼©å›¾ç‰‡
                    const compressedUrl = await this.compressImage(file, 600, 0.7);
                    return compressedUrl;
                } catch (error) {
                    console.error('å›¾ç‰‡å¤„ç†å¤±è´¥:', error);
                    // å¦‚æœå‹ç¼©å¤±è´¥ï¼Œè¿”å›åŸæ–‡ä»¶base64
                    return await this.fileToBase64(file);
                }
            }
        };

        // ========== æ•°æ® - ä¸ªäººäººåƒä½œå“é›†ï¼ˆè¡Œå¼åˆ†ç»„ï¼‰ ==========
        let portfolioGroups = DataManager.getPortfolio();

        let currentStyleFilter = 'all';

        let isPhotographerMode = DataManager.getPhotographerMode();
        let currentTab = 'discover';
        let currentBookingTab = 'sent';
        let selectedStyles = [];
        let selectedBookingType = '';

        // ä¸Šä¼ çš„ç…§ç‰‡ç¼“å­˜
        let uploadPhotosCache = [];
        
        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–æ•°æ®å­˜å‚¨
            DataManager.init();

            // åŠ è½½çœŸå®æ•°æ®
            portfolioGroups = DataManager.getPortfolio();

            // æ¢å¤æ‘„å½±å¸ˆæ¨¡å¼çŠ¶æ€
            isPhotographerMode = DataManager.getPhotographerMode();
            if (isPhotographerMode) {
                document.body.classList.add('photographer-mode-on');
                updatePhotographerModeUI();
            }

            renderPhotoList();
            setupCustomStyleInput();
            updateNavigationVisibility();
            updateSelectedStylesDisplay();

            // æ¸²æŸ“é¢„çº¦åˆ—è¡¨
            renderBookingList();

            console.log('å…‰å½±ä½œå“é›† V3.2 å·²åŠ è½½ï¼Œæ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨æ¢å¤');
        });
        
        // ========== æ¸²æŸ“ä¸ªäººä½œå“é›†ï¼ˆè¡Œå¼å¸ƒå±€ï¼‰ ==========
        function renderPhotoList() {
            const rowsContainer = document.getElementById('portfolio-rows');
            if (!rowsContainer) return;

            // ä½¿ç”¨çœŸå®æ•°æ®
            portfolioGroups = DataManager.getPortfolio();

            // æ ¹æ®ç­›é€‰æ¡ä»¶è¿‡æ»¤
            const filteredGroups = currentStyleFilter === 'all'
                ? portfolioGroups
                : portfolioGroups.filter(group => group.style === currentStyleFilter);

            if (filteredGroups.length === 0) {
                rowsContainer.innerHTML = '<div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">è¯¥é£æ ¼æš‚æ— ä½œå“</div>';
                return;
            }

            rowsContainer.innerHTML = filteredGroups.map(group => `
                <div class="photo-row" data-group-id="${group.id}">
                    <div class="row-header">
                        <div class="row-title">
                            ${group.title}
                            <span class="row-count">${group.count} å¼ </span>
                        </div>
                    </div>
                    <div class="row-photos">
                        ${group.photos.map((photo, index) => `
                            <div class="row-photo-item ${photo.size}" onclick="showPhotoDetail(${group.id}, ${photo.id})">
                                <img src="${photo.src}" alt="${photo.desc}" loading="lazy">
                                ${index === 0 ? `<span class="row-style-tag">${group.style}</span>` : ''}
                                <div class="row-photo-overlay">
                                    <div class="row-photo-title">${photo.desc || group.title}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // é£æ ¼ç­›é€‰åŠŸèƒ½
        function filterByStyle(style, element) {
            currentStyleFilter = style;

            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.style-filter-tag').forEach(tag => {
                tag.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }

            // é‡æ–°æ¸²æŸ“
            renderPhotoList();

            // æ˜¾ç¤ºæç¤º
            const styleNames = {
                'all': 'å…¨éƒ¨ä½œå“',
                'æ¸…æ–°': 'æ¸…æ–°è‡ªç„¶',
                'å¤å¤': 'å¤å¤èƒ¶ç‰‡',
                'æƒ…ç»ª': 'æƒ…ç»ªäººåƒ',
                'å¤é£': 'å¤é£æ±‰æœ'
            };
            showToast(`å·²ç­›é€‰ï¼š${styleNames[style] || style}`);
        }

        function clearStyleFilter() {
            currentStyleFilter = 'all';
            document.querySelectorAll('.style-filter-tag').forEach(tag => {
                tag.classList.remove('active');
            });
            document.querySelector('.style-filter-tag:first-child').classList.add('active');
            renderPhotoList();
            showToast('å·²æ˜¾ç¤ºå…¨éƒ¨ä½œå“');
        }
        
        function toggleCardLike(element) {
            const svg = element.querySelector('svg');
            const isLiked = svg.getAttribute('fill') === 'currentColor';
            
            if (isLiked) {
                svg.setAttribute('fill', 'none');
                svg.style.color = '';
            } else {
                svg.setAttribute('fill', 'currentColor');
                svg.style.color = '#ED4956';
                showToast('å·²ç‚¹èµï¼');
            }
        }
        
        // ========== Tabåˆ‡æ¢ ==========
        function switchTab(tab) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ‘„å½±å¸ˆæ¨¡å¼
            if (!isPhotographerMode && (tab === 'portfolio' || tab === 'booking')) {
                showModeNotice();
                return;
            }

            currentTab = tab;

            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById('page-' + tab).classList.add('active');

            // æ›´æ–°å¯¼èˆªæ æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === tab) {
                    item.classList.add('active');
                }
            });
        }
        
        // ========== å‘ç°é¡µåŠŸèƒ½ ==========
        function handleSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            } else {
                document.getElementById('search-results').style.display = 'block';
            }
        }
        
        function performSearch() {
            const query = document.getElementById('search-input').value;
            if (query.trim()) {
                showToast(`æœç´¢ï¼š${query}`);
                document.getElementById('search-results').style.display = 'none';
            }
        }
        
        function quickSearch(keyword) {
            document.getElementById('search-input').value = keyword;
            performSearch();
        }
        
        function filterByStyle(style) {
            document.querySelectorAll('.style-tag').forEach(tag => {
                tag.classList.remove('active');
                if (tag.textContent === style || (style === 'all' && tag.textContent === 'å…¨éƒ¨')) {
                    tag.classList.add('active');
                }
            });
            showToast(`ç­›é€‰ï¼š${style === 'all' ? 'å…¨éƒ¨' : style}`);
        }
        
        // ========== ç…§ç‰‡è¯¦æƒ…é¡µ ==========
        function showPhotoDetail(groupId, photoId) {
            const group = portfolioGroups.find(g => g.id === groupId);
            if (group) {
                const photo = group.photos.find(p => p.id === photoId);
                if (photo) {
                    // ä¿å­˜å½“å‰æŸ¥çœ‹çš„ä½œå“IDï¼ˆç”¨äºç‚¹èµ/æ”¶è—ï¼‰
                    window.currentPhotoGroupId = groupId;

                    // æ·»åŠ åˆ°æµè§ˆå†å²
                    DataManager.addToHistory({
                        id: groupId,
                        title: group.title,
                        cover: photo.src,
                        style: group.style
                    });

                    document.getElementById('detail-image').src = photo.src;
                    document.getElementById('detail-title').textContent = group.title;

                    // æ˜¾ç¤ºçœŸå®ç‚¹èµæ•°
                    const likeCount = DataManager.getLikeCount(groupId);
                    document.getElementById('detail-likes').textContent = likeCount.toLocaleString() + ' æ¬¡èµ';

                    // æ›´æ–°ç‚¹èµå›¾æ ‡çŠ¶æ€
                    const likeIcon = document.getElementById('like-icon');
                    if (DataManager.isLiked(groupId)) {
                        likeIcon.setAttribute('fill', 'currentColor');
                        likeIcon.style.color = '#ED4956';
                    } else {
                        likeIcon.setAttribute('fill', 'none');
                        likeIcon.style.color = '';
                    }

                    // æ›´æ–°æ”¶è—å›¾æ ‡çŠ¶æ€
                    updateFavoriteIcon(groupId);

                    // æ›´æ–°é£æ ¼æ ‡ç­¾
                    const styleContainer = document.getElementById('detail-styles');
                    styleContainer.innerHTML = `<span class="photo-detail-style">${group.style}</span>`;

                    document.getElementById('photo-detail-page').classList.add('show');
                }
            }
        }

        // æ›´æ–°æ”¶è—å›¾æ ‡çŠ¶æ€
        function updateFavoriteIcon(groupId) {
            // æ”¶è—å›¾æ ‡åœ¨ actions ä¸­ï¼Œæˆ‘ä»¬ç¨åæ·»åŠ 
        }

        function closePhotoDetail() {
            document.getElementById('photo-detail-page').classList.remove('show');
        }
        
        function toggleLike() {
            const likeIcon = document.getElementById('like-icon');
            const currentGroupId = window.currentPhotoGroupId;
            const isLiked = DataManager.isLiked(currentGroupId);

            // åˆ‡æ¢ç‚¹èµçŠ¶æ€
            DataManager.toggleLike(currentGroupId);
            const newIsLiked = !isLiked;

            if (newIsLiked) {
                likeIcon.setAttribute('fill', 'currentColor');
                likeIcon.style.color = '#ED4956';
                showToast('å·²ç‚¹èµï¼');
            } else {
                likeIcon.setAttribute('fill', 'none');
                likeIcon.style.color = '';
            }

            // æ›´æ–°ç‚¹èµæ•°
            const likeCount = DataManager.getLikeCount(currentGroupId);
            document.getElementById('detail-likes').textContent = likeCount.toLocaleString() + ' æ¬¡èµ';
        }
        
        // ========== å‘èµ·é¢„çº¦å¼¹çª— ==========
        function showBookingModal(photographerName) {
            if (photographerName) {
                document.querySelector('.photographer-preview-name').textContent = photographerName;
            }
            document.getElementById('booking-modal').classList.add('show');
        }
        
        function closeBookingModal() {
            document.getElementById('booking-modal').classList.remove('show');
            resetBookingForm();
        }
        
        function resetBookingForm() {
            selectedBookingType = '';
            document.querySelectorAll('.booking-type-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('booking-date').value = '';
            document.getElementById('booking-time').value = '';
            document.getElementById('booking-location').value = '';
            document.getElementById('booking-style').value = '';
            document.getElementById('booking-notes').value = '';
            document.getElementById('booking-phone').value = '';
        }
        
        function selectBookingType(element) {
            document.querySelectorAll('.booking-type-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedBookingType = element.textContent;
        }
        
        function submitBooking() {
            // éªŒè¯å¿…å¡«é¡¹
            if (!selectedBookingType) {
                showToast('è¯·é€‰æ‹©æ‹æ‘„ç±»å‹');
                shakeElement(document.querySelector('.booking-type-options'));
                return;
            }
            if (!document.getElementById('booking-date').value) {
                showToast('è¯·é€‰æ‹©æœŸæœ›æ‹æ‘„æ—¥æœŸ');
                document.getElementById('booking-date').focus();
                return;
            }
            const phone = document.getElementById('booking-phone').value;
            if (!phone) {
                showToast('è¯·å¡«å†™è”ç³»ç”µè¯');
                document.getElementById('booking-phone').focus();
                return;
            }
            if (!Utils.validatePhone(phone)) {
                showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ');
                document.getElementById('booking-phone').focus();
                return;
            }

            // è·å–æ‘„å½±å¸ˆä¿¡æ¯
            const photographerName = document.querySelector('.photographer-preview-name').textContent;
            const photographerStyles = document.querySelector('.photographer-preview-style').textContent.replace('æ“…é•¿ï¼š', '');

            // åˆ›å»ºé¢„çº¦æ•°æ®
            const newBooking = {
                id: 'BK' + Date.now().toString(36).toUpperCase(),
                photographerName: photographerName,
                type: selectedBookingType,
                date: document.getElementById('booking-date').value,
                timeSlot: document.getElementById('booking-time').value,
                location: document.getElementById('booking-location').value,
                style: document.getElementById('booking-style').value,
                notes: document.getElementById('booking-notes').value,
                phone: phone,
                status: 'pending',
                photos: [],
                createdAt: new Date().toISOString()
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const sentBookings = DataManager.getSentBookings();
            sentBookings.unshift(newBooking);
            DataManager.saveSentBookings(sentBookings);

            // å…³é—­å¼¹çª—å¹¶é‡ç½®è¡¨å•
            closeBookingModal();

            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showToast('é¢„çº¦ç”³è¯·å·²å‘é€ï¼è¯·ç­‰å¾…æ‘„å½±å¸ˆç¡®è®¤');

            // åˆ·æ–°é¢„çº¦åˆ—è¡¨
            renderBookingList();
        }
        
        // ========== ä¸Šä¼ ä½œå“å¼¹çª— ==========
        function showUploadModal() {
            document.getElementById('upload-modal').classList.add('show');
        }

        function closeUploadModal() {
            document.getElementById('upload-modal').classList.remove('show');
            resetUploadForm();
        }

        function resetUploadForm() {
            document.getElementById('upload-title').value = '';
            document.getElementById('upload-notes').value = '';
            document.getElementById('upload-camera').value = '';
            document.getElementById('upload-lens').value = '';
            selectedStyles = [];
            updateSelectedStylesDisplay();
            document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('selected'));

            // æ¸…ç©ºä¸Šä¼ é¢„è§ˆ
            const photoSection = document.querySelector('.upload-photo-section');
            const addBtn = photoSection.querySelector('.upload-photo-item');
            photoSection.innerHTML = '';
            photoSection.appendChild(addBtn);

            uploadPhotosCache = [];
        }

        // é€‰æ‹©ä¸Šä¼ ç…§ç‰‡
        async function selectUploadPhoto() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = true;
            input.onchange = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                showLoading('æ­£åœ¨å¤„ç†å›¾ç‰‡...');

                try {
                    for (const file of files.slice(0, 9)) { // æœ€å¤š9å¼ 
                        // å‹ç¼©å¹¶ä¿å­˜å›¾ç‰‡
                        const imageUrl = await Utils.saveImageToStorage(file);
                        uploadPhotosCache.push({
                            id: Utils.generateId('photo_'),
                            src: imageUrl,
                            file: file
                        });

                        // æ›´æ–°é¢„è§ˆUI
                        updateUploadPreview();
                    }
                    showSuccess(`å·²æ·»åŠ  ${uploadPhotosCache.length} å¼ ç…§ç‰‡`);
                } catch (error) {
                    showError('å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•');
                    console.error(error);
                } finally {
                    hideLoading();
                }
            };
            input.click();
        }

        // æ›´æ–°ä¸Šä¼ é¢„è§ˆ
        function updateUploadPreview() {
            const photoSection = document.querySelector('.upload-photo-section');
            const addBtn = photoSection.querySelector('.upload-photo-item');

            // ä¿ç•™æ·»åŠ æŒ‰é’®
            photoSection.innerHTML = '';

            // æ·»åŠ å·²é€‰æ‹©çš„ç…§ç‰‡
            uploadPhotosCache.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = 'upload-photo-preview';
                div.innerHTML = `
                    <img src="${photo.src}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                    <div class="upload-photo-remove" onclick="removeUploadPhoto(${index})">Ã—</div>
                `;
                photoSection.appendChild(div);
            });

            // æ·»åŠ æŒ‰é’®ï¼ˆæœ€å¤š9å¼ ï¼‰
            if (uploadPhotosCache.length < 9) {
                photoSection.appendChild(addBtn);
            }
        }

        // ç§»é™¤ä¸Šä¼ çš„ç…§ç‰‡
        function removeUploadPhoto(index) {
            uploadPhotosCache.splice(index, 1);
            updateUploadPreview();
        }
        
        // é£æ ¼æ ‡ç­¾é€‰æ‹©
        function toggleStyleOption(element) {
            const style = element.textContent;
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedStyles = selectedStyles.filter(s => s !== style);
            } else {
                element.classList.add('selected');
                if (!selectedStyles.includes(style)) {
                    selectedStyles.push(style);
                }
            }
            updateSelectedStylesDisplay();
        }
        
        function setupCustomStyleInput() {
            const input = document.getElementById('custom-style-input');
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomStyle();
                }
            });
        }
        
        function addCustomStyle() {
            const input = document.getElementById('custom-style-input');
            const style = input.value.trim();
            if (style && !selectedStyles.includes(style)) {
                selectedStyles.push(style);
                updateSelectedStylesDisplay();
                input.value = '';
            }
        }
        
        function removeSelectedStyle(style) {
            selectedStyles = selectedStyles.filter(s => s !== style);
            updateSelectedStylesDisplay();
            // åŒæ—¶å–æ¶ˆé¢„è®¾é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.style-option').forEach(opt => {
                if (opt.textContent === style) {
                    opt.classList.remove('selected');
                }
            });
        }
        
        function updateSelectedStylesDisplay() {
            const container = document.getElementById('selected-styles');
            if (selectedStyles.length === 0) {
                container.innerHTML = '<span style="color: var(--text-secondary); font-size: 13px;">æœªé€‰æ‹©æ ‡ç­¾</span>';
            } else {
                container.innerHTML = selectedStyles.map(style => `
                    <span class="selected-style-tag">
                        ${style}
                        <span class="remove" onclick="removeSelectedStyle('${style}')">Ã—</span>
                    </span>
                `).join('');
            }
        }
        
        function submitUpload() {
            const title = document.getElementById('upload-title').value.trim();
            if (!title) {
                showToast('è¯·å¡«å†™ä½œå“æ ‡é¢˜');
                document.getElementById('upload-title').focus();
                return;
            }
            if (uploadPhotosCache.length === 0) {
                showToast('è¯·è‡³å°‘æ·»åŠ ä¸€å¼ ç…§ç‰‡');
                return;
            }

            // åˆ›å»ºæ–°ä½œå“ç»„
            const newGroup = {
                id: Utils.generateId('group_'),
                title: title,
                style: selectedStyles.length > 0 ? selectedStyles[0] : 'å…¶ä»–',
                count: uploadPhotosCache.length,
                photos: uploadPhotosCache.map((photo, index) => ({
                    id: Utils.generateId('photo_'),
                    src: photo.src,
                    size: index === 0 ? 'large' : 'medium',
                    desc: title
                })),
                notes: document.getElementById('upload-notes').value,
                camera: document.getElementById('upload-camera').value,
                lens: document.getElementById('upload-lens').value,
                createdAt: new Date().toISOString()
            };

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const portfolio = DataManager.getPortfolio();
            portfolio.unshift(newGroup);
            DataManager.savePortfolio(portfolio);

            // å…³é—­å¼¹çª—
            closeUploadModal();

            // åˆ·æ–°ä½œå“åˆ—è¡¨
            renderPhotoList();

            showSuccess('ä½œå“å‘å¸ƒæˆåŠŸï¼');

            // åˆ‡æ¢åˆ°ä½œå“é¡µæŸ¥çœ‹
            if (isPhotographerMode) {
                setTimeout(() => {
                    switchTab('portfolio');
                    showToast('æ–°ä½œå“å·²æ·»åŠ åˆ°ä½œå“é›†');
                }, 500);
            }
        }
        
        // ========== ç¼–è¾‘æˆ‘çš„ä½œå“ ==========
        function editMyWork(id) {
            // ä»æœ¬åœ°å­˜å‚¨è·å–çœŸå®æ•°æ®
            const portfolio = DataManager.getPortfolio();
            const work = portfolio.find(g => g.id == id) || portfolio[0];

            if (!work) {
                showToast('ä½œå“ä¸å­˜åœ¨');
                return;
            }

            const content = `
                <div style="padding-bottom: 100px;">
                    <!-- ä½œå“å›¾ç‰‡ -->
                    <div style="padding: 20px; text-align: center;">
                        <img src="${work.photos[0]?.src || ''}" style="width: 100%; max-width: 300px; height: 300px; object-fit: cover; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    </div>

                    <!-- ç¼–è¾‘è¡¨å• -->
                    <div style="padding: 0 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">ä½œå“æ ‡é¢˜</label>
                            <input type="text" id="edit-work-title" value="${work.title}" style="width: 100%; padding: 14px 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 15px; font-family: inherit; background: white;" placeholder="è¾“å…¥ä½œå“æ ‡é¢˜">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">é£æ ¼æ ‡ç­¾</label>
                            <input type="text" id="edit-work-style" value="${work.style}" style="width: 100%; padding: 14px 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 15px; font-family: inherit; background: white;" placeholder="å¦‚ï¼šæ¸…æ–°ã€å¤å¤ã€æƒ…ç»ª">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">ä½œå“æè¿°</label>
                            <textarea id="edit-work-desc" style="width: 100%; padding: 14px 16px; border: 1px solid var(--border); border-radius: 12px; font-size: 15px; font-family: inherit; background: white; min-height: 80px; resize: vertical;" placeholder="æè¿°è¿™å¼ ç…§ç‰‡...">${work.photos[0]?.desc || ''}</textarea>
                        </div>

                        <div style="background: var(--bg); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">æ‹æ‘„è®¾å¤‡</div>
                            <div style="margin-bottom: 12px;">
                                <input type="text" id="edit-work-camera" value="${work.camera || ''}" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; margin-bottom: 8px;" placeholder="ç›¸æœºå‹å·">
                                <input type="text" id="edit-work-lens" value="${work.lens || ''}" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;" placeholder="é•œå¤´">
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('edit-work-content').innerHTML = content;
            document.getElementById('edit-work-modal').classList.add('show');
        }

        function closeEditWorkModal() {
            document.getElementById('edit-work-modal').classList.remove('show');
        }

        function saveWork() {
            const title = document.getElementById('edit-work-title')?.value?.trim();
            const style = document.getElementById('edit-work-style')?.value?.trim();
            const desc = document.getElementById('edit-work-desc')?.value?.trim();
            const camera = document.getElementById('edit-work-camera')?.value?.trim();
            const lens = document.getElementById('edit-work-lens')?.value?.trim();

            if (!title) {
                showToast('è¯·å¡«å†™ä½œå“æ ‡é¢˜');
                document.getElementById('edit-work-title')?.focus();
                return;
            }

            // è·å–å½“å‰ä½œå“æ•°æ®
            const portfolio = DataManager.getPortfolio();
            if (portfolio.length > 0) {
                portfolio[0].title = title;
                portfolio[0].style = style || 'å…¶ä»–';
                if (portfolio[0].photos[0]) {
                    portfolio[0].photos[0].desc = desc;
                }
                portfolio[0].camera = camera;
                portfolio[0].lens = lens;

                DataManager.savePortfolio(portfolio);

                // åˆ·æ–°ä½œå“åˆ—è¡¨
                renderPhotoList();
            }

            closeEditWorkModal();
            showSuccess('ä½œå“å·²ä¿å­˜');
        }
        
        // ========== é¢„çº¦åŠŸèƒ½ ==========
        function renderBookingList() {
            const sentContainer = document.getElementById('booking-sent');
            const receivedContainer = document.getElementById('booking-received');

            // æ¸²æŸ“æˆ‘å‘å‡ºçš„é¢„çº¦
            const sentBookings = DataManager.getSentBookings();
            if (sentBookings.length === 0) {
                sentContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“…</div>
                        <div>æš‚æ— å‘å‡ºçš„é¢„çº¦</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">å»å‘ç°é¡µé¢„çº¦æ‘„å½±å¸ˆå§</div>
                    </div>
                `;
            } else {
                sentContainer.innerHTML = sentBookings.map(booking => createBookingCard(booking, 'sent')).join('');
            }

            // æ¸²æŸ“æˆ‘æ”¶åˆ°çš„é¢„çº¦
            const receivedBookings = DataManager.getReceivedBookings();
            if (receivedBookings.length === 0) {
                receivedContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“¬</div>
                        <div>æš‚æ— æ”¶åˆ°çš„é¢„çº¦</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">å¼€å¯æ‘„å½±å¸ˆæ¨¡å¼åå¯ä»¥æ¥æ”¶é¢„çº¦</div>
                    </div>
                `;
            } else {
                receivedContainer.innerHTML = receivedBookings.map(booking => createBookingCard(booking, 'received')).join('');
            }
        }

        // åˆ›å»ºé¢„çº¦å¡ç‰‡HTML
        function createBookingCard(booking, type) {
            const isSent = type === 'sent';
            const statusClass = getStatusClass(booking.status);

            let actionButtons = '';
            switch (booking.status) {
                case 'pending':
                    actionButtons = isSent
                        ? `<button class="booking-action-btn danger" onclick="cancelBooking('${booking.id}', '${type}')">å–æ¶ˆé¢„çº¦</button>`
                        : `<button class="booking-action-btn secondary" onclick="chatWithClient('${booking.id}')">æ²Ÿé€š</button>
                           <button class="booking-action-btn danger" onclick="rejectBooking('${booking.id}')">å©‰æ‹’</button>
                           <button class="booking-action-btn confirm" onclick="confirmBooking('${booking.id}')">ç¡®è®¤é¢„çº¦</button>`;
                    break;
                case 'confirmed':
                    actionButtons = `<button class="booking-action-btn secondary" onclick="showContactModal('${isSent ? booking.photographerName : booking.clientName}', 'wechat_${booking.id}')">è”ç³»${isSent ? 'æ‘„å½±å¸ˆ' : 'å®¢æˆ·'}</button>`;
                    break;
                case 'shooting':
                    actionButtons = `<button class="booking-action-btn confirm" onclick="completeShooting('${booking.id}', '${type}')">å®Œæˆæ‹æ‘„</button>`;
                    break;
                case 'review':
                    actionButtons = `<button class="booking-action-btn confirm" onclick="rateBooking('${booking.id}', '${type}')">å»è¯„ä»·</button>`;
                    break;
                case 'completed':
                    actionButtons = `<button class="booking-action-btn secondary" onclick="viewResults('${booking.id}', '${type}')">æŸ¥çœ‹æˆç‰‡</button>`;
                    break;
                case 'cancelled':
                    actionButtons = '';
                    break;
            }

            return `
                <div class="booking-card" data-status="${booking.status}" data-id="${booking.id}">
                    <div class="booking-card-header">
                        <div class="booking-user">
                            <div class="booking-avatar">${isSent ? 'ğŸ“·' : (booking.clientAvatar || 'å®¢')}</div>
                            <div class="booking-info">
                                <h4>${isSent ? booking.photographerName : (booking.clientName || 'å®¢æˆ·')}</h4>
                                <p>${isSent ? 'æ‘„å½±å¸ˆ' : Utils.formatTimeAgo(booking.createdAt)}</p>
                            </div>
                        </div>
                        <span class="badge ${statusClass}">${getStatusLabel(booking.status)}</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>${isSent ? 'æœŸæœ›æ—¶é—´' : 'æœŸæœ›æ—¶é—´'}ï¼š${Utils.formatDate(booking.date)} ${Utils.getTimeSlotText(booking.timeSlot).split(' ')[0]}</span>
                    </div>
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                        </svg>
                        <span>${booking.type}${booking.style ? ' Â· ' + booking.style : ''}</span>
                    </div>
                    ${booking.location ? `
                    <div class="booking-detail">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span>${booking.location}</span>
                    </div>
                    ` : ''}
                    ${booking.photos && booking.photos.length > 0 ? `
                    <div class="booking-photos">
                        ${booking.photos.map(photo => `<img class="booking-photo" src="${photo}" alt="">`).join('')}
                    </div>
                    ` : ''}
                    <div class="booking-actions">
                        ${actionButtons}
                        <button class="booking-action-btn secondary" onclick="viewBookingDetail('${type}', '${booking.status}', '${booking.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                    </div>
                </div>
            `;
        }

        // è·å–çŠ¶æ€æ ·å¼ç±»
        function getStatusClass(status) {
            const classes = {
                'pending': 'badge-pending',
                'confirmed': 'badge-confirmed',
                'shooting': 'badge-shooting',
                'review': 'badge-review',
                'completed': 'badge-completed',
                'cancelled': 'badge-cancelled'
            };
            return classes[status] || 'badge-pending';
        }

        function switchBookingTab(type) {
            currentBookingTab = type;
            document.querySelectorAll('.booking-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            if (type === 'sent') {
                document.getElementById('booking-sent').style.display = 'block';
                document.getElementById('booking-received').style.display = 'none';
            } else {
                document.getElementById('booking-sent').style.display = 'none';
                document.getElementById('booking-received').style.display = 'block';
            }
        }
        
        function filterBookingStatus(status) {
            document.querySelectorAll('.booking-status-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.textContent.includes(getStatusLabel(status))) {
                    tab.classList.add('active');
                }
            });

            const container = currentBookingTab === 'sent' ? 'booking-sent' : 'booking-received';
            document.querySelectorAll(`#${container} .booking-card`).forEach(card => {
                if (status === 'all' || card.dataset.status === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });

            showToast(`ç­›é€‰ï¼š${getStatusLabel(status)}`);
        }

        function confirmBooking(bookingId) {
            const bookings = DataManager.getReceivedBookings();
            const booking = bookings.find(b => b.id === bookingId);
            if (booking) {
                booking.status = 'confirmed';
                DataManager.saveReceivedBookings(bookings);
                renderBookingList();
                showToast('å·²ç¡®è®¤é¢„çº¦ï¼å·²é€šçŸ¥å¯¹æ–¹');
            }
        }

        function rejectBooking(bookingId) {
            if (confirm('ç¡®å®šè¦å©‰æ‹’è¿™ä¸ªé¢„çº¦å—ï¼Ÿå¯¹æ–¹å°†æ”¶åˆ°é€šçŸ¥ã€‚')) {
                const bookings = DataManager.getReceivedBookings();
                const index = bookings.findIndex(b => b.id === bookingId);
                if (index !== -1) {
                    bookings.splice(index, 1);
                    DataManager.saveReceivedBookings(bookings);
                    renderBookingList();
                    showToast('å·²å©‰æ‹’é¢„çº¦');
                }
            }
        }

        function cancelBooking(bookingId, type) {
            if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                if (type === 'sent') {
                    const bookings = DataManager.getSentBookings();
                    const index = bookings.findIndex(b => b.id === bookingId);
                    if (index !== -1) {
                        bookings[index].status = 'cancelled';
                        DataManager.saveSentBookings(bookings);
                        renderBookingList();
                        showToast('é¢„çº¦å·²å–æ¶ˆ');
                    }
                }
            }
        }

        function completeShooting(bookingId, type) {
            // æ˜¾ç¤ºå®Œæˆæ‹æ‘„å¼¹çª—
            showCompleteModal();

            // å»¶è¿Ÿæ›´æ–°çŠ¶æ€
            setTimeout(() => {
                if (type === 'received') {
                    const bookings = DataManager.getReceivedBookings();
                    const booking = bookings.find(b => b.id === bookingId);
                    if (booking) {
                        booking.status = 'review';
                        DataManager.saveReceivedBookings(bookings);
                        renderBookingList();
                    }
                }
            }, 3000);
        }

        function rateBooking(bookingId, type) {
            showToast('è¯„ä»·åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function viewResults(bookingId, type) {
            showToast('æŸ¥çœ‹æˆç‰‡åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function chatWithClient(bookingId) {
            showToast('èŠå¤©åŠŸèƒ½å¼€å‘ä¸­...\nå¯é€šè¿‡å¾®ä¿¡è”ç³»');
        }

        function getStatusLabel(status) {
            });
            
            const container = currentBookingTab === 'sent' ? 'booking-sent' : 'booking-received';
            document.querySelectorAll(`#${container} .booking-card`).forEach(card => {
                if (status === 'all' || card.dataset.status === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            
            showToast(`ç­›é€‰ï¼š${getStatusLabel(status)}`);
        }
        
        function getStatusLabel(status) {
            const labels = {
                'all': 'å…¨éƒ¨',
                'pending': 'å¾…ç¡®è®¤',
                'confirmed': 'å·²ç¡®è®¤',
                'shooting': 'æ‹æ‘„ä¸­',
                'review': 'å¾…è¯„ä»·',
                'completed': 'å·²å®Œæˆ',
                'cancelled': 'å·²å–æ¶ˆ'
            };
            return labels[status] || status;
        }
        
        function confirmBooking() {
            showToast('å·²ç¡®è®¤é¢„çº¦ï¼å·²é€šçŸ¥å¯¹æ–¹');
        }
        
        function rejectBooking() {
            if (confirm('ç¡®å®šè¦å©‰æ‹’è¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                showToast('å·²å©‰æ‹’é¢„çº¦');
            }
        }
        
        function cancelBooking() {
            if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                showToast('é¢„çº¦å·²å–æ¶ˆ');
            }
        }
        
        function chatWithClient() {
            showToast('æ‰“å¼€èŠå¤©çª—å£...');
        }
        
        function viewBookingDetail(type, status, bookingId) {
            const isSent = type === 'sent';
            const statusLabel = getStatusLabel(status);

            // ä»æœ¬åœ°å­˜å‚¨è·å–çœŸå®æ•°æ®
            let booking = null;
            if (isSent) {
                const bookings = DataManager.getSentBookings();
                booking = bookings.find(b => b.id === bookingId);
            } else {
                const bookings = DataManager.getReceivedBookings();
                booking = bookings.find(b => b.id === bookingId);
            }

            if (!booking) {
                showToast('é¢„çº¦ä¿¡æ¯ä¸å­˜åœ¨');
                return;
            }

            // æ ¹æ®çŠ¶æ€è®¾ç½®ä¸åŒçš„æ ·å¼å’ŒæŒ‰é’®
            let statusBadgeClass = getStatusClass(booking.status);
            let actionButtons = '';

            switch(booking.status) {
                case 'pending':
                    actionButtons = isSent
                        ? `<button class="booking-action-btn danger" onclick="cancelBooking('${booking.id}', '${type}')">å–æ¶ˆé¢„çº¦</button>`
                        : `<button class="booking-action-btn secondary" onclick="chatWithClient('${booking.id}')">æ²Ÿé€š</button><button class="booking-action-btn danger" onclick="rejectBooking('${booking.id}')">å©‰æ‹’</button><button class="booking-action-btn confirm" onclick="confirmBooking('${booking.id}')">ç¡®è®¤é¢„çº¦</button>`;
                    break;
                case 'confirmed':
                    actionButtons = `<button class="booking-action-btn secondary" onclick="showContactModal('${isSent ? booking.photographerName : booking.clientName}', 'wechat_${booking.id}')">è”ç³»${isSent ? 'æ‘„å½±å¸ˆ' : 'å®¢æˆ·'}</button>`;
                    break;
                case 'shooting':
                    actionButtons = `<button class="booking-action-btn confirm" onclick="completeShooting('${booking.id}', '${type}')">å®Œæˆæ‹æ‘„</button>`;
                    break;
                case 'review':
                    actionButtons = `<button class="booking-action-btn confirm" onclick="rateBooking('${booking.id}', '${type}')">å»è¯„ä»·</button>`;
                    break;
                case 'completed':
                    actionButtons = `<button class="booking-action-btn secondary" onclick="showToast('æŸ¥çœ‹æˆç‰‡åŠŸèƒ½å¼€å‘ä¸­')">æŸ¥çœ‹æˆç‰‡</button>`;
                    break;
                case 'cancelled':
                    actionButtons = '';
                    break;
            }

            const otherName = isSent ? booking.photographerName : (booking.clientName || 'å®¢æˆ·');
            const otherAvatar = isSent ? 'æ—' : (booking.clientAvatar || 'å®¢');

            const content = `
                <div style="padding-bottom: 20px;">
                    <!-- çŠ¶æ€ -->
                    <div style="text-align: center; margin-bottom: 24px;">
                        <span class="badge ${statusBadgeClass}" style="font-size: 14px; padding: 8px 20px;">${statusLabel}</span>
                    </div>

                    <!-- ç”¨æˆ·ä¿¡æ¯ -->
                    <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--bg); border-radius: 16px; margin-bottom: 20px;">
                        <div style="width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 20px;">
                            ${otherAvatar}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 17px; font-weight: 600; margin-bottom: 4px;">${otherName}</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">${isSent ? 'æ‘„å½±å¸ˆ' : 'å®¢æˆ·'} Â· ${Utils.formatTimeAgo(booking.createdAt)}</div>
                        </div>
                    </div>

                    <!-- é¢„çº¦ä¿¡æ¯ -->
                    <div style="background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 16px; text-transform: uppercase;">é¢„çº¦ä¿¡æ¯</div>

                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ‹æ‘„ç±»å‹</div>
                            <div style="font-size: 16px; font-weight: 500; color: var(--text);">${booking.type}</div>
                        </div>

                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æœŸæœ›æ—¶é—´</div>
                            <div style="font-size: 16px; font-weight: 500; color: var(--text);">${Utils.formatDate(booking.date)} ${Utils.getTimeSlotText(booking.timeSlot).split(' ')[0]}</div>
                        </div>

                        ${booking.location ? `
                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ‹æ‘„åœ°ç‚¹</div>
                            <div style="font-size: 16px; font-weight: 500; color: var(--text);">${booking.location}</div>
                        </div>
                        ` : ''}

                        ${booking.style ? `
                        <div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æœŸæœ›é£æ ¼</div>
                            <div style="font-size: 16px; font-weight: 500; color: var(--text);">${booking.style}</div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- å¤‡æ³¨ -->
                    ${booking.notes ? `
                    <div style="background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase;">å¤‡æ³¨è¯´æ˜</div>
                        <div style="font-size: 15px; color: var(--text); line-height: 1.6;">
                            ${booking.notes}
                        </div>
                    </div>
                    ` : ''}

                    <!-- å‚è€ƒç…§ç‰‡ -->
                    ${booking.photos && booking.photos.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase;">å‚è€ƒç…§ç‰‡</div>
                        <div style="display: flex; gap: 12px; overflow-x: auto;">
                            ${booking.photos.map(photo => `<img src="${photo}" style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover; flex-shrink: 0;">`).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- é¢„çº¦ç¼–å·å’Œæ—¶é—´ -->
                    <div style="padding: 16px; background: var(--bg); border-radius: 12px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 13px; color: var(--text-secondary);">é¢„çº¦ç¼–å·</span>
                            <span style="font-size: 13px; color: var(--text);">${booking.id}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-size: 13px; color: var(--text-secondary);">åˆ›å»ºæ—¶é—´</span>
                            <span style="font-size: 13px; color: var(--text);">${Utils.formatTimeAgo(booking.createdAt)}</span>
                        </div>
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="booking-actions" style="gap: 12px;">
                        ${actionButtons}
                    </div>
                </div>
            `;

            document.getElementById('booking-detail-content').innerHTML = content;
            document.getElementById('booking-detail-modal').classList.add('show');
        }
        
        function closeBookingDetailModal() {
            document.getElementById('booking-detail-modal').classList.remove('show');
        }
        
        // è”ç³»æ‘„å½±å¸ˆå¼¹çª—
        function showContactModal(photographerName, wechatId) {
            document.getElementById('contact-name').textContent = photographerName;
            document.getElementById('wechat-id').textContent = wechatId;
            document.getElementById('contact-modal').classList.add('show');
        }
        
        function closeContactModal() {
            document.getElementById('contact-modal').classList.remove('show');
        }
        
        function copyWechatId() {
            const wechatId = document.getElementById('wechat-id').textContent;
            navigator.clipboard.writeText(wechatId).then(() => {
                showToast('å¾®ä¿¡å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                showToast('å¾®ä¿¡å·ï¼š' + wechatId);
            });
        }
        
        // å®Œæˆæ‹æ‘„å¼¹çª—
        function showCompleteModal() {
            document.getElementById('complete-modal').classList.add('show');
        }
        
        function closeCompleteModal() {
            document.getElementById('complete-modal').classList.remove('show');
        }
        
        // ========== æˆ‘çš„é¡µé¢åŠŸèƒ½ ==========
        function togglePhotographerMode() {
            isPhotographerMode = !isPhotographerMode;

            // ä¿å­˜çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
            DataManager.setPhotographerMode(isPhotographerMode);

            updatePhotographerModeUI();

            if (isPhotographerMode) {
                document.body.classList.add('photographer-mode-on');
                showToast('æ‘„å½±å¸ˆæ¨¡å¼å·²å¼€å¯ï¼ç°åœ¨å¯ä»¥ç®¡ç†ä½œå“å’Œé¢„çº¦');

                // åˆ·æ–°é¢„çº¦åˆ—è¡¨
                renderBookingList();
            } else {
                document.body.classList.remove('photographer-mode-on');
                showToast('æ‘„å½±å¸ˆæ¨¡å¼å·²å…³é—­');

                // å¦‚æœå½“å‰åœ¨ä½œå“æˆ–é¢„çº¦é¡µé¢ï¼Œåˆ‡æ¢åˆ°åç‰‡é¡µ
                if (currentTab === 'portfolio' || currentTab === 'booking') {
                    switchTab('discover');
                }
            }

            updateNavigationVisibility();
        }

        // æ›´æ–°æ‘„å½±å¸ˆæ¨¡å¼UI
        function updatePhotographerModeUI() {
            const card = document.getElementById('photographer-mode-card');
            const toggle = document.getElementById('mode-toggle');
            const text = document.getElementById('mode-toggle-text');
            const desc = document.getElementById('mode-desc');

            if (isPhotographerMode) {
                card.classList.remove('disabled');
                toggle.classList.add('active');
                text.textContent = 'âœ“ å·²å¼€å¯';
                desc.innerHTML = `
                    <strong>ä½ å½“å‰æ˜¯ã€æ‘„å½±å¸ˆã€‘èº«ä»½</strong><br>
                    â€¢ å¯ä»¥ç®¡ç†ä½œå“é›†<br>
                    â€¢ æ¥æ”¶æ‹æ‘„é¢„çº¦<br>
                    â€¢ ç®¡ç†å®¢æˆ·å’¨è¯¢
                `;
            } else {
                card.classList.add('disabled');
                toggle.classList.remove('active');
                text.textContent = 'å¼€å¯æ‘„å½±å¸ˆåŠŸèƒ½';
                desc.textContent = 'å¼€å¯åï¼Œä½ å¯ä»¥ç®¡ç†ä½œå“é›†å¹¶æ¥æ”¶å…¶ä»–ç”¨æˆ·çš„æ‹æ‘„é¢„çº¦';
            }
        }

        // æ›´æ–°å¯¼èˆªæ æ˜¾ç¤ºçŠ¶æ€
        function updateNavigationVisibility() {
            const photographerTabs = document.querySelectorAll('.nav-item.photographer-only');
            photographerTabs.forEach(tab => {
                tab.style.display = isPhotographerMode ? 'flex' : 'none';
            });

            // é‡æ–°è°ƒæ•´åº•éƒ¨å¯¼èˆªå¸ƒå±€
            const bottomNav = document.getElementById('bottom-nav');
            if (isPhotographerMode) {
                bottomNav.style.justifyContent = 'space-around';
            } else {
                bottomNav.style.justifyContent = 'space-around';
            }
        }

        // æ˜¾ç¤ºæ¨¡å¼æç¤º
        function showModeNotice() {
            document.getElementById('mode-notice').classList.add('show');
        }

        function closeModeNotice() {
            document.getElementById('mode-notice').classList.remove('show');
        }
        
        // ========== è®¾ç½®é¡µé¢ ==========
        function showProfileSettings() {
            const content = `
                <div class="profile-edit-header" style="padding: 32px 20px; text-align: center; background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); border-bottom: 1px solid var(--border);">
                    <div style="position: relative; display: inline-block;">
                        <img class="profile-avatar-large" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face" alt="å¤´åƒ" style="width: 96px; height: 96px; border-radius: 50%; margin-bottom: 12px; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <div style="position: absolute; bottom: 16px; right: 0; width: 32px; height: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" onclick="changeAvatar()">ğŸ“·</div>
                    </div>
                    <div style="margin-top: 8px;">
                        <input type="text" value="æ—æ‚¦" style="font-size: 20px; font-weight: 700; text-align: center; border: none; border-bottom: 2px solid var(--accent); background: transparent; width: 120px; padding: 4px; margin-bottom: 4px;" placeholder="æ˜µç§°">
                    </div>
                    <div style="margin-top: 4px;">
                        <input type="text" value="@linyue_photo" style="font-size: 14px; color: var(--text-secondary); text-align: center; border: none; border-bottom: 1px solid var(--border); background: transparent; width: 150px; padding: 2px;" placeholder="ç”¨æˆ·å">
                    </div>
                    <div style="margin-top: 12px;">
                        <textarea style="font-size: 14px; color: var(--text); text-align: center; border: 1px solid var(--border); border-radius: 8px; background: white; width: 90%; padding: 10px; resize: none; font-family: inherit;" rows="2" placeholder="ä¸ªäººç®€ä»‹">"ç”¨é•œå¤´è®°å½•ä¸œæ–¹å¥³æ€§çš„ç‹¬ç‰¹æ°”è´¨ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯æ—¶å…‰çš„è‰ºæœ¯"</textarea>
                    </div>
                </div>
                
                <div style="padding: 20px 16px;">
                    <div style="background: white; border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 16px; text-transform: uppercase;">åŸºæœ¬ä¿¡æ¯</div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ‘„å½±èº«ä»½</label>
                            <input type="text" value="PORTRAIT PHOTOGRAPHER" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; font-family: inherit; background: var(--bg);" placeholder="å¦‚ï¼šäººåƒæ‘„å½±å¸ˆ">
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ‰€åœ¨åŸå¸‚</label>
                            <input type="text" value="ä¸Šæµ·" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; font-family: inherit; background: var(--bg);" placeholder="å¦‚ï¼šåŒ—äº¬">
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ“…é•¿é£æ ¼</label>
                            <input type="text" value="æ¸…æ–°è‡ªç„¶ã€å¤å¤èƒ¶ç‰‡ã€å¤é£æ±‰æœ" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; font-family: inherit; background: var(--bg);" placeholder="å¦‚ï¼šæ—¥ç³»ã€å¤å¤ã€æƒ…ç»ª">
                        </div>
                    </div>
                    
                    <div style="background: white; border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 16px; text-transform: uppercase;">è”ç³»ä¿¡æ¯</div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">å¾®ä¿¡å· <span style="font-size: 11px; color: var(--accent);">ï¼ˆç”¨äºå®¢æˆ·è”ç³»ï¼‰</span></label>
                            <input type="text" value="linyue_photo" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; font-family: inherit; background: var(--bg);" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">è”ç³»ç”µè¯</label>
                            <input type="tel" value="13800000000" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; font-family: inherit; background: var(--bg);" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                        </div>
                    </div>
                </div>
                
                <div style="height: 100px;"></div>
                <div style="position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 414px; padding: 16px; background: white; border-top: 1px solid var(--border);">
                    <button style="width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);" onclick="saveProfile()">ä¿å­˜ä¿®æ”¹</button>
                </div>
            `;
            openSettingsModal('ç¼–è¾‘ä¸ªäººèµ„æ–™', content);
        }

        function saveProfile() {
            // è·å–è¡¨å•æ•°æ®
            const inputs = document.querySelectorAll('#settings-content input, #settings-content textarea');
            const profile = DataManager.getUserProfile();

            inputs.forEach(input => {
                const label = input.previousElementSibling?.textContent?.trim() || '';
                const value = input.value.trim();

                if (label.includes('æ˜µç§°') || input.value === 'æ—æ‚¦') {
                    profile.name = value;
                } else if (label.includes('ç”¨æˆ·å') || value.startsWith('@')) {
                    profile.handle = value;
                } else if (label.includes('ç®€ä»‹') || input.tagName === 'TEXTAREA') {
                    profile.bio = value;
                } else if (label.includes('æ‘„å½±èº«ä»½')) {
                    profile.role = value;
                } else if (label.includes('æ‰€åœ¨åŸå¸‚')) {
                    profile.city = value;
                } else if (label.includes('æ“…é•¿é£æ ¼')) {
                    profile.styles = value;
                } else if (label.includes('å¾®ä¿¡å·')) {
                    profile.wechat = value;
                } else if (label.includes('è”ç³»ç”µè¯')) {
                    profile.phone = value;
                }
            });

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            DataManager.saveUserProfile(profile);

            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.querySelector('.profile-name-large').textContent = profile.name;
            document.querySelector('.profile-handle').textContent = profile.handle;
            document.querySelector('.profile-bio').textContent = profile.bio || '"ç”¨é•œå¤´è®°å½•ä¸œæ–¹å¥³æ€§çš„ç‹¬ç‰¹æ°”è´¨ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯æ—¶å…‰çš„è‰ºæœ¯"';

            closeSettingsModal();
            showSuccess('ä¸ªäººèµ„æ–™å·²ä¿å­˜');
        }
        
        function showNotificationSettings() {
            const content = `
                <div class="settings-section">
                    <div class="settings-title">æ¨é€é€šçŸ¥</div>
                    <div class="settings-item">
                        <span class="settings-item-text">æ–°é¢„çº¦æé†’</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">é¢„çº¦çŠ¶æ€å˜æ›´</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">æ–°æ”¶è—/ç‚¹èµ</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">æ–°ç²‰ä¸</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">æ¶ˆæ¯è®¾ç½®</div>
                    <div class="settings-item">
                        <span class="settings-item-text">ç³»ç»Ÿå…¬å‘Š</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">æ´»åŠ¨æ¨è</span>
                        <span class="settings-item-value">â—‹</span>
                    </div>
                </div>
            `;
            openSettingsModal('æ¶ˆæ¯é€šçŸ¥', content);
        }
        
        function showPrivacySettings() {
            const content = `
                <div class="settings-section">
                    <div class="settings-title">è´¦å·éšç§</div>
                    <div class="settings-item">
                        <span class="settings-item-text">ä½œå“é›†å…¬å¼€</span>
                        <span class="settings-item-value">âœ“ æ‰€æœ‰äººå¯è§</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">å…è®¸è¢«æœç´¢</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">å¾®ä¿¡å·å¯¹å¤–å±•ç¤º</span>
                        <span class="settings-item-value">â—‹ ä»…é¢„çº¦å</span>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">äº’åŠ¨è®¾ç½®</div>
                    <div class="settings-item">
                        <span class="settings-item-text">å…è®¸è¯„è®º</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">å…è®¸æ”¶è—</span>
                        <span class="settings-item-value">âœ“</span>
                    </div>
                </div>
            `;
            openSettingsModal('éšç§è®¾ç½®', content);
        }
        
        function showHelpCenter() {
            const content = `
                <div class="settings-section">
                    <div class="settings-title">å¸¸è§é—®é¢˜</div>
                    <div class="settings-item" onclick="showHelpCenterDetail('publish')">
                        <span class="settings-item-text">å¦‚ä½•å‘å¸ƒä½œå“ï¼Ÿ</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="settings-item" onclick="showHelpCenterDetail('booking')">
                        <span class="settings-item-text">å¦‚ä½•é¢„çº¦æ‘„å½±å¸ˆï¼Ÿ</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="settings-item" onclick="showHelpCenterDetail('mode')">
                        <span class="settings-item-text">æ‘„å½±å¸ˆæ¨¡å¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="settings-item" onclick="showNotifications()">
                        <span class="settings-item-text">æŸ¥çœ‹æ¶ˆæ¯é€šçŸ¥</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                    <div class="settings-item" onclick="showBrowsingHistory()">
                        <span class="settings-item-text">æµè§ˆå†å²</span>
                        <span class="menu-arrow">â€º</span>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">è”ç³»æˆ‘ä»¬</div>
                    <div class="settings-item">
                        <span class="settings-item-text">å®¢æœå¾®ä¿¡</span>
                        <span class="settings-item-value">guangying_helper</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-text">å®¢æœé‚®ç®±</span>
                        <span class="settings-item-value">help@guangying.app</span>
                    </div>
                </div>
            `;
            openSettingsModal('å¸®åŠ©ä¸­å¿ƒ', content);
        }

        function openSettingsModal(title, content) {
            document.getElementById('settings-title').textContent = title;
            document.getElementById('settings-content').innerHTML = content;
            document.getElementById('settings-modal').classList.add('show');
        }
        
        function closeSettingsModal() {
            document.getElementById('settings-modal').classList.remove('show');
        }
        
        // ========== é€šç”¨åŠŸèƒ½ ==========
        function showToast(message, duration = 2000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // å…ƒç´ æŠ–åŠ¨åŠ¨ç”»
        function shakeElement(element) {
            element.style.animation = 'none';
            element.offsetHeight; // è§¦å‘é‡æ’
            element.style.animation = 'shake 0.5s ease';
        }

        // æ·»åŠ æŠ–åŠ¨æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                20%, 60% { transform: translateX(-5px); }
                40%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(text = 'åŠ è½½ä¸­...') {
            const loading = document.createElement('div');
            loading.id = 'loading-overlay';
            loading.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255,255,255,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                flex-direction: column;
                gap: 12px;
            `;
            loading.innerHTML = `
                <div style="width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <div style="font-size: 14px; color: var(--text-secondary);">${text}</div>
            `;
            document.body.appendChild(loading);
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            const loading = document.getElementById('loading-overlay');
            if (loading) loading.remove();
        }

        // æ·»åŠ æ—‹è½¬åŠ¨ç”»
        const spinStyle = document.createElement('style');
        spinStyle.textContent = `
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(spinStyle);

        // ç¡®è®¤å¯¹è¯æ¡†
        function showConfirm(message, onConfirm) {
            if (confirm(message)) {
                onConfirm();
            }
        }

        // æ˜¾ç¤ºæˆåŠŸæç¤ºï¼ˆç»¿è‰²ï¼‰
        function showSuccess(message) {
            showToast('âœ“ ' + message);
        }

        // æ˜¾ç¤ºé”™è¯¯æç¤ºï¼ˆçº¢è‰²ï¼‰
        function showError(message) {
            const toast = document.getElementById('toast');
            toast.textContent = 'âœ• ' + message;
            toast.style.background = 'rgba(237, 73, 86, 0.9)';
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
                toast.style.background = 'rgba(0,0,0,0.8)';
            }, 3000);
        }

        // ç”µè¯å’¨è¯¢åŠŸèƒ½
        function callPhone() {
            const profile = DataManager.getUserProfile();
            const phone = profile.phone || '13800000000';

            if (navigator.clipboard) {
                navigator.clipboard.writeText(phone).then(() => {
                    showToast('ç”µè¯å·²å¤åˆ¶: ' + phone);
                }).catch(() => {
                    window.location.href = 'tel:' + phone;
                });
            } else {
                window.location.href = 'tel:' + phone;
            }
        }

        // ========== æ”¶è—åŠŸèƒ½ ==========
        function toggleFavorite() {
            const groupId = window.currentPhotoGroupId;
            const isFavorite = DataManager.isFavorite(groupId);

            if (isFavorite) {
                DataManager.removeFavorite(groupId);
                showToast('å·²å–æ¶ˆæ”¶è—');
            } else {
                DataManager.addFavorite(groupId);
                showToast('å·²æ”¶è—ï¼');
            }

            // æ›´æ–°å›¾æ ‡
            updateFavoriteIcon(groupId);
        }

        function updateFavoriteIcon(groupId) {
            const favIcon = document.getElementById('favorite-icon');
            if (favIcon) {
                if (DataManager.isFavorite(groupId)) {
                    favIcon.setAttribute('fill', 'currentColor');
                    favIcon.style.color = '#ED4956';
                } else {
                    favIcon.setAttribute('fill', 'none');
                    favIcon.style.color = '';
                }
            }
        }

        // ========== è¯„è®ºåŠŸèƒ½ ==========
        function showComments() {
            const groupId = window.currentPhotoGroupId;
            const comments = DataManager.getComments(groupId);

            const commentsHtml = comments.length === 0
                ? '<div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</div>'
                : comments.map(c => `
                    <div style="display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border);">
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; flex-shrink: 0;">
                            ${c.userName ? c.userName[0] : 'ç”¨'}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">${c.userName || 'ç”¨æˆ·'}</div>
                            <div style="font-size: 14px; color: var(--text); line-height: 1.5; margin-bottom: 6px;">${c.content}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${Utils.formatTimeAgo(c.createdAt)}</div>
                        </div>
                    </div>
                `).join('');

            const content = `
                <div style="padding-bottom: 80px;">
                    <div style="max-height: 300px; overflow-y: auto; margin-bottom: 16px;">
                        ${commentsHtml}
                    </div>

                    <!-- æ·»åŠ è¯„è®º -->
                    <div style="position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 414px; background: white; border-top: 1px solid var(--border); padding: 12px 16px 32px;">
                        <div style="display: flex; gap: 12px;">
                            <input type="text" id="comment-input" style="flex: 1; padding: 12px 16px; border: 1px solid var(--border); border-radius: 20px; font-size: 14px; outline: none;" placeholder="è¯´ç‚¹ä»€ä¹ˆ...">
                            <button onclick="submitComment()" style="padding: 12px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 20px; font-size: 14px; font-weight: 600;">å‘å¸ƒ</button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('settings-title').textContent = 'è¯„è®º';
            document.getElementById('settings-content').innerHTML = content;
            document.getElementById('settings-modal').classList.add('show');

            // ç»‘å®šå›è½¦é”®
            document.getElementById('comment-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitComment();
                }
            });
        }

        function submitComment() {
            const input = document.getElementById('comment-input');
            const content = input.value.trim();

            if (!content) {
                showToast('è¯·è¾“å…¥è¯„è®ºå†…å®¹');
                return;
            }

            const groupId = window.currentPhotoGroupId;
            DataManager.addComment(groupId, {
                userName: 'æˆ‘',
                content: content
            });

            showSuccess('è¯„è®ºå‘å¸ƒæˆåŠŸ');
            closeSettingsModal();

            // åˆ·æ–°è¯„è®º
            setTimeout(() => {
                showComments();
            }, 500);
        }

        // ========== åˆ†äº«åŠŸèƒ½ ==========
        function sharePhoto() {
            const groupId = window.currentPhotoGroupId;
            const group = portfolioGroups.find(g => g.id === groupId);

            if (navigator.share) {
                navigator.share({
                    title: group?.title || 'å…‰å½±ä½œå“é›†',
                    text: 'æ¥çœ‹çœ‹è¿™ä¸ªç²¾å½©çš„ä½œå“ï¼',
                    url: window.location.href
                }).catch(console.error);
            } else {
                // å¤åˆ¶åˆ†äº«é“¾æ¥
                navigator.clipboard.writeText(window.location.href).then(() => {
                    showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }).catch(() => {
                    showToast('åˆ†äº«åŠŸèƒ½ï¼š' + group?.title);
                });
            }
        }

        // ========== æ›´æ¢å¤´åƒ ==========
        function changeAvatar() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                showLoading('æ­£åœ¨ä¸Šä¼ å¤´åƒ...');

                try {
                    const avatarUrl = await Utils.saveImageToStorage(file);

                    // æ›´æ–°ç”¨æˆ·èµ„æ–™
                    const profile = DataManager.getUserProfile();
                    profile.avatar = avatarUrl;
                    DataManager.saveUserProfile(profile);

                    // æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„å¤´åƒ
                    document.querySelectorAll('.card-avatar, .profile-avatar-large, .portfolio-avatar, .photo-detail-avatar, .contact-avatar').forEach(img => {
                        img.src = avatarUrl;
                    });

                    showSuccess('å¤´åƒæ›´æ¢æˆåŠŸ');
                } catch (error) {
                    showError('å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•');
                } finally {
                    hideLoading();
                }
            };
            input.click();
        }

        // ========== åˆ é™¤ä½œå“ ==========
        function deleteWork(workId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä½œå“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                return;
            }

            const portfolio = DataManager.getPortfolio();
            const index = portfolio.findIndex(g => g.id == workId);

            if (index !== -1) {
                portfolio.splice(index, 1);
                DataManager.savePortfolio(portfolio);

                // åˆ·æ–°ä½œå“åˆ—è¡¨
                renderPhotoList();

                // å¦‚æœæ˜¯ä½œå“é¡µï¼Œä¹Ÿåˆ·æ–°ç½‘æ ¼
                const grid = document.getElementById('portfolio-grid');
                if (grid) {
                    renderPortfolioGrid();
                }

                showSuccess('ä½œå“å·²åˆ é™¤');
                closeEditWorkModal();
            }
        }

        // æ¸²æŸ“ä½œå“é¡µç½‘æ ¼
        function renderPortfolioGrid() {
            const portfolio = DataManager.getPortfolio();
            const grid = document.getElementById('portfolio-grid');

            if (!grid) return;

            grid.innerHTML = portfolio.flatMap(group =>
                group.photos.map((photo, idx) => `
                    <div class="portfolio-grid-item ${group.photos.length > 1 ? 'multi' : ''}" onclick="editMyWork(${group.id})">
                        <img src="${photo.src}" alt="${photo.desc}">
                        <div class="portfolio-grid-overlay">
                            <div class="portfolio-grid-stats">
                                <div class="portfolio-grid-stat">
                                    <svg width="16" height="16" fill="white" viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                    ${DataManager.getLikeCount(group.id)}
                                </div>
                            </div>
                        </div>
                    </div>
                `)
            ).join('');
        }

        // ========== åˆ é™¤é¢„çº¦ ==========
        function deleteBooking(bookingId, type) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                return;
            }

            if (type === 'sent') {
                const bookings = DataManager.getSentBookings();
                const index = bookings.findIndex(b => b.id === bookingId);
                if (index !== -1) {
                    bookings.splice(index, 1);
                    DataManager.saveSentBookings(bookings);
                    renderBookingList();
                    showSuccess('é¢„çº¦å·²åˆ é™¤');
                }
            } else {
                const bookings = DataManager.getReceivedBookings();
                const index = bookings.findIndex(b => b.id === bookingId);
                if (index !== -1) {
                    bookings.splice(index, 1);
                    DataManager.saveReceivedBookings(bookings);
                    renderBookingList();
                    showSuccess('é¢„çº¦å·²åˆ é™¤');
                }
            }
        }

        // ========== æœç´¢åŠŸèƒ½ ==========
        let searchTimeout = null;

        function performSearch() {
            const query = document.getElementById('search-input')?.value?.trim().toLowerCase() || '';

            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }

            // é˜²æŠ–æœç´¢
            searchTimeout = setTimeout(() => {
                if (!query) {
                    renderPhotoList();
                    showToast('å·²æ˜¾ç¤ºå…¨éƒ¨ä½œå“');
                    return;
                }

                const portfolio = DataManager.getPortfolio();
                const filtered = portfolio.filter(group =>
                    group.title.toLowerCase().includes(query) ||
                    group.style.toLowerCase().includes(query) ||
                    group.photos.some(p => p.desc.toLowerCase().includes(query))
                );

                renderFilteredResults(filtered, query);
                showToast(`æ‰¾åˆ° ${filtered.length} ä¸ªç›¸å…³ä½œå“`);
            }, 300);
        }

        function renderFilteredResults(filtered, query) {
            const rowsContainer = document.getElementById('portfolio-rows');
            if (!rowsContainer) return;

            if (filtered.length === 0) {
                rowsContainer.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”</div>
                        <div>æœªæ‰¾åˆ°"${query}"ç›¸å…³ä½œå“</div>
                        <div style="font-size: 13px; margin-top: 8px;">è¯•è¯•å…¶ä»–å…³é”®è¯</div>
                    </div>
                `;
                return;
            }

            rowsContainer.innerHTML = filtered.map(group => `
                <div class="photo-row" data-group-id="${group.id}">
                    <div class="row-header">
                        <div class="row-title">
                            ${group.title}
                            <span class="row-count">${group.count} å¼ </span>
                        </div>
                    </div>
                    <div class="row-photos">
                        ${group.photos.map((photo, index) => `
                            <div class="row-photo-item ${photo.size}" onclick="showPhotoDetail(${group.id}, ${photo.id})">
                                <img src="${photo.src}" alt="${photo.desc}" loading="lazy">
                                ${index === 0 ? `<span class="row-style-tag">${group.style}</span>` : ''}
                                <div class="row-photo-overlay">
                                    <div class="row-photo-title">${photo.desc}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // ========== æµè§ˆå†å² ==========
        function showBrowsingHistory() {
            const history = DataManager.getBrowsingHistory();

            const content = history.length === 0
                ? `<div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
                    <div>æš‚æ— æµè§ˆè®°å½•</div>
                   </div>`
                : history.map(item => `
                    <div style="display: flex; gap: 12px; padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="showPhotoDetail(${item.id}, ${item.photos?.[0]?.id || 101})">
                        <img src="${item.cover}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                        <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 4px;">${item.title}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${item.style} Â· ${Utils.formatTimeAgo(item.viewedAt)}</div>
                        </div>
                    </div>
                `).join('') + (history.length > 0 ? `
                    <div style="padding: 16px; text-align: center;">
                        <button onclick="clearBrowsingHistory()" style="padding: 12px 24px; background: var(--bg); border: none; border-radius: 8px; font-size: 14px; color: var(--text-secondary); cursor: pointer;">æ¸…ç©ºæµè§ˆè®°å½•</button>
                    </div>
                ` : '');

            openSettingsModal('æµè§ˆå†å²', `<div style="padding-bottom: 20px;">${content}</div>`);
        }

        function clearBrowsingHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æµè§ˆè®°å½•å—ï¼Ÿ')) {
                DataManager.clearHistory();
                showSuccess('æµè§ˆè®°å½•å·²æ¸…ç©º');
                closeSettingsModal();
            }
        }

        // ========== å¸®åŠ©ä¸­å¿ƒ ==========
        function showHelpCenterDetail(topic) {
            const helpContent = {
                'publish': {
                    title: 'å¦‚ä½•å‘å¸ƒä½œå“ï¼Ÿ',
                    content: `
                        <div style="padding: 20px; line-height: 1.8;">
                            <p style="margin-bottom: 16px;">å‘å¸ƒä½œå“çš„æ­¥éª¤ï¼š</p>
                            <ol style="padding-left: 20px;">
                                <li style="margin-bottom: 12px;">ç‚¹å‡»åº•éƒ¨å¯¼èˆªçš„"æˆ‘çš„ä½œå“"ï¼ˆéœ€å¼€å¯æ‘„å½±å¸ˆæ¨¡å¼ï¼‰</li>
                                <li style="margin-bottom: 12px;">ç‚¹å‡»å³ä¸Šè§’çš„ä¸Šä¼ æŒ‰é’®</li>
                                <li style="margin-bottom: 12px;">é€‰æ‹©è¦å‘å¸ƒçš„ç…§ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼‰</li>
                                <li style="margin-bottom: 12px;">å¡«å†™ä½œå“æ ‡é¢˜å’Œé£æ ¼æ ‡ç­¾</li>
                                <li style="margin-bottom: 12px;">æ·»åŠ åˆ›ä½œæƒ³æ³•å’Œæ‹æ‘„å‚æ•°ï¼ˆå¯é€‰ï¼‰</li>
                                <li>ç‚¹å‡»"å‘å¸ƒä½œå“"å®Œæˆ</li>
                            </ol>
                        </div>
                    `
                },
                'booking': {
                    title: 'å¦‚ä½•é¢„çº¦æ‘„å½±å¸ˆï¼Ÿ',
                    content: `
                        <div style="padding: 20px; line-height: 1.8;">
                            <p style="margin-bottom: 16px;">é¢„çº¦æ‘„å½±å¸ˆéå¸¸ç®€å•ï¼š</p>
                            <ol style="padding-left: 20px;">
                                <li style="margin-bottom: 12px;">åœ¨å‘ç°é¡µæµè§ˆæ‘„å½±å¸ˆä½œå“</li>
                                <li style="margin-bottom: 12px;">ç‚¹å‡»"é¢„çº¦æ‹æ‘„"æŒ‰é’®</li>
                                <li style="margin-bottom: 12px;">é€‰æ‹©æ‹æ‘„ç±»å‹å’Œæ—¶é—´</li>
                                <li style="margin-bottom: 12px;">å¡«å†™è”ç³»æ–¹å¼å’Œå¤‡æ³¨</li>
                                <li>ç­‰å¾…æ‘„å½±å¸ˆç¡®è®¤é¢„çº¦</li>
                            </ol>
                            <p style="margin-top: 16px; color: var(--text-secondary); font-size: 13px;">æç¤ºï¼šé¢„çº¦æˆåŠŸåï¼Œä½ å¯ä»¥åœ¨"é¢„çº¦ä¸­å¿ƒ"æŸ¥çœ‹é¢„çº¦çŠ¶æ€</p>
                        </div>
                    `
                },
                'mode': {
                    title: 'æ‘„å½±å¸ˆæ¨¡å¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ',
                    content: `
                        <div style="padding: 20px; line-height: 1.8;">
                            <p style="margin-bottom: 16px;">å¼€å¯æ‘„å½±å¸ˆæ¨¡å¼åï¼Œä½ å¯ä»¥ï¼š</p>
                            <ul style="padding-left: 20px;">
                                <li style="margin-bottom: 8px;">ğŸ“¸ <strong>ç®¡ç†ä½œå“é›†</strong> - ä¸Šä¼ ã€ç¼–è¾‘ã€åˆ é™¤ä½ çš„ä½œå“</li>
                                <li style="margin-bottom: 8px;">ğŸ“… <strong>æ¥æ”¶é¢„çº¦</strong> - å®¢æˆ·å¯ä»¥å‘ä½ å‘èµ·æ‹æ‘„é¢„çº¦</li>
                                <li style="margin-bottom: 8px;">ğŸ’¬ <strong>å®¢æˆ·å’¨è¯¢</strong> - é€šè¿‡å¾®ä¿¡ä¸å®¢æˆ·æ²Ÿé€š</li>
                                <li style="margin-bottom: 8px;">ğŸ“Š <strong>æ•°æ®ç»Ÿè®¡</strong> - æŸ¥çœ‹ä½œå“æ”¶è—ã€ç‚¹èµæ•°æ®</li>
                            </ul>
                            <p style="margin-top: 16px; color: var(--text-secondary); font-size: 13px;">æç¤ºï¼šä»…å¼€å¯æ‘„å½±å¸ˆæ¨¡å¼åï¼Œå…¶ä»–ç”¨æˆ·æ‰èƒ½å‘ä½ å‘èµ·é¢„çº¦</p>
                        </div>
                    `
                }
            };

            const help = helpContent[topic];
            if (help) {
                openSettingsModal(help.title, help.content);
            }
        }

        // ========== é€šçŸ¥ä¸­å¿ƒ ==========
        function showNotifications() {
            const notifications = DataManager.getNotifications();
            const unreadCount = DataManager.getUnreadCount();

            const content = notifications.length === 0
                ? `<div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ””</div>
                    <div>æš‚æ— æ¶ˆæ¯é€šçŸ¥</div>
                   </div>`
                : notifications.map(n => `
                    <div style="display: flex; gap: 12px; padding: 16px; border-bottom: 1px solid var(--border); background: ${n.read ? 'transparent' : 'rgba(56, 151, 240, 0.05)'};">
                        <div style="font-size: 24px;">${n.icon || 'ğŸ“¬'}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 14px; font-weight: 600; margin-bottom: 4px;">${n.title}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">${n.content}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${Utils.formatTimeAgo(n.createdAt)}</div>
                        </div>
                        ${!n.read ? '<div style="width: 8px; height: 8px; background: var(--accent); border-radius: 50%; flex-shrink: 0;"></div>' : ''}
                    </div>
                `).join('') + (notifications.length > 0 ? `
                    <div style="padding: 16px; text-align: center;">
                        <button onclick="markAllAsRead()" style="padding: 12px 24px; background: var(--bg); border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">å…¨éƒ¨æ ‡ä¸ºå·²è¯»</button>
                    </div>
                ` : '');

            openSettingsModal('æ¶ˆæ¯é€šçŸ¥' + (unreadCount > 0 ? ` (${unreadCount})` : ''), `<div style="padding-bottom: 20px;">${content}</div>`);
        }

        function markAllAsRead() {
            DataManager.markAllAsRead();
            showSuccess('å·²å…¨éƒ¨æ ‡ä¸ºå·²è¯»');
            closeSettingsModal();
        }

        // ========== åˆå§‹åŒ–é¡µé¢ç‰¹å®šæ¸²æŸ“ ==========
        document.addEventListener('DOMContentLoaded', () => {
            // æ¸²æŸ“ä½œå“é¡µç½‘æ ¼
            setTimeout(renderPortfolioGrid, 100);
            // æ›´æ–°ç™»å½•çŠ¶æ€
            updateLoginState();
        });

        // ========== ç™»å½•æ¨¡å—åŠŸèƒ½ ==========

        // æ˜¾ç¤ºç™»å½•å¼¹å±‚
        function showLoginModal() {
            document.getElementById('login-modal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // å…³é—­ç™»å½•å¼¹å±‚
        function closeLoginModal() {
            document.getElementById('login-modal').classList.remove('show');
            document.body.style.overflow = '';
            // æ¸…ç©ºè¡¨å•
            document.getElementById('login-phone').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('code-phone').value = '';
            document.getElementById('verify-code').value = '';
        }

        // åˆ‡æ¢ç™»å½•æ–¹å¼
        function switchLoginTab(tab) {
            // æ›´æ–°tabæ ·å¼
            document.querySelectorAll('.login-tab').forEach(t => {
                t.classList.remove('active');
                if (t.dataset.tab === tab) {
                    t.classList.add('active');
                }
            });

            // æ›´æ–°è¡¨å•æ˜¾ç¤º
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            document.getElementById('form-' + tab).classList.add('active');
        }

        // è·å–éªŒè¯ç 
        let countdownTimer = null;

        function getVerifyCode() {
            const phone = document.getElementById('code-phone').value.trim();

            // éªŒè¯æ‰‹æœºå·
            if (!phone) {
                showToast('è¯·è¾“å…¥æ‰‹æœºå·');
                document.getElementById('code-phone').focus();
                return;
            }

            if (!Utils.validatePhone(phone)) {
                showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                document.getElementById('code-phone').focus();
                return;
            }

            // ç”Ÿæˆå¹¶ä¿å­˜éªŒè¯ç 
            const code = DataManager.generateCode();
            DataManager.saveVerifyCode(phone, code);

            // æ¨¡æ‹Ÿå‘é€éªŒè¯ç ï¼ˆå®é™…åº”ä¸ºæœåŠ¡å™¨å‘é€ï¼‰
            console.log('éªŒè¯ç :', code); // è°ƒè¯•ç”¨

            // å¼€å§‹å€’è®¡æ—¶
            let count = 60;
            const btn = document.getElementById('get-code-btn');
            btn.disabled = true;
            btn.textContent = `${count}s`;

            countdownTimer = setInterval(() => {
                count--;
                if (count <= 0) {
                    clearInterval(countdownTimer);
                    btn.disabled = false;
                    btn.textContent = 'è·å–éªŒè¯ç ';
                } else {
                    btn.textContent = `${count}s`;
                }
            }, 1000);

            showToast('éªŒè¯ç å·²å‘é€ï¼Œè¯·æŸ¥æ”¶çŸ­ä¿¡');
        }

        // æ‰‹æœºå·ç™»å½•
        function loginWithPhone() {
            const phone = document.getElementById('login-phone').value.trim();
            const password = document.getElementById('login-password').value;
            const remember = document.getElementById('remember-me').checked;

            // è¡¨å•éªŒè¯
            if (!phone) {
                showToast('è¯·è¾“å…¥æ‰‹æœºå·');
                document.getElementById('login-phone').focus();
                return;
            }

            if (!Utils.validatePhone(phone)) {
                showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                document.getElementById('login-phone').focus();
                return;
            }

            if (!password) {
                showToast('è¯·è¾“å…¥å¯†ç ');
                document.getElementById('login-password').focus();
                return;
            }

            if (password.length < 6) {
                showToast('å¯†ç è‡³å°‘6ä½');
                return;
            }

            // æ‰§è¡Œç™»å½•
            showLoading('ç™»å½•ä¸­...');
            setTimeout(() => {
                const result = DataManager.loginWithPhone(phone, password);
                hideLoading();

                if (result.success) {
                    currentUser = result.user;
                    isLoggedIn = true;
                    closeLoginModal();
                    updateLoginState();
                    showSuccess('ç™»å½•æˆåŠŸï¼Œæ¬¢è¿ ' + (result.user.nickname || result.user.phone));

                    // æ·»åŠ æ¬¢è¿é€šçŸ¥
                    DataManager.addNotification({
                        icon: 'ğŸ‰',
                        title: 'æ¬¢è¿å›æ¥',
                        content: result.user.nickname ? `å¾ˆé«˜å…´å†æ¬¡è§åˆ°ä½ ï¼Œ${result.user.nickname}ï¼` : 'ç™»å½•æˆåŠŸï¼Œå¼€å§‹æ¢ç´¢ç²¾å½©ä½œå“å§ï¼'
                    });
                } else {
                    showError(result.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            }, 800);
        }

        // éªŒè¯ç ç™»å½•
        function loginWithCode() {
            const phone = document.getElementById('code-phone').value.trim();
            const code = document.getElementById('verify-code').value.trim();

            // è¡¨å•éªŒè¯
            if (!phone) {
                showToast('è¯·è¾“å…¥æ‰‹æœºå·');
                document.getElementById('code-phone').focus();
                return;
            }

            if (!Utils.validatePhone(phone)) {
                showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                document.getElementById('code-phone').focus();
                return;
            }

            if (!code) {
                showToast('è¯·è¾“å…¥éªŒè¯ç ');
                document.getElementById('verify-code').focus();
                return;
            }

            if (code.length !== 6) {
                showToast('éªŒè¯ç ä¸º6ä½æ•°å­—');
                return;
            }

            // éªŒè¯éªŒè¯ç 
            if (!DataManager.verifyCode(phone, code)) {
                showError('éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ');
                return;
            }

            // æ‰§è¡Œç™»å½•
            showLoading('ç™»å½•ä¸­...');
            setTimeout(() => {
                const result = DataManager.loginWithCode(phone, code);
                hideLoading();

                if (result.success) {
                    currentUser = result.user;
                    isLoggedIn = true;
                    closeLoginModal();
                    updateLoginState();
                    showSuccess('ç™»å½•æˆåŠŸï¼Œæ¬¢è¿ ' + (result.user.nickname || 'ç”¨æˆ·' + phone.slice(-4)));

                    // æ·»åŠ æ¬¢è¿é€šçŸ¥
                    DataManager.addNotification({
                        icon: 'ğŸ‘‹',
                        title: 'æ¬¢è¿ç™»å½•',
                        content: 'ç™»å½•æˆåŠŸï¼Œå¼€å§‹æ¢ç´¢ç²¾å½©ä½œå“å§ï¼'
                    });
                } else {
                    showError(result.message || 'ç™»å½•å¤±è´¥');
                }
            }, 800);
        }

        // å¾®ä¿¡ç™»å½•
        function loginWithWechat() {
            // æ¨¡æ‹Ÿå¾®ä¿¡æˆæƒç™»å½•
            showLoading('å¾®ä¿¡æˆæƒä¸­...');

            setTimeout(() => {
                // æ¨¡æ‹Ÿå¾®ä¿¡è¿”å›çš„ç”¨æˆ·ä¿¡æ¯
                const mockWechatData = {
                    openId: 'wechat_' + Date.now(),
                    nickname: 'å¾®ä¿¡ç”¨æˆ·' + Math.floor(Math.random() * 10000),
                    avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200&h=200&fit=crop&crop=face'
                };

                const result = DataManager.loginWithWechat(mockWechatData);
                hideLoading();

                if (result.success) {
                    currentUser = result.user;
                    isLoggedIn = true;
                    closeLoginModal();
                    updateLoginState();
                    showSuccess('å¾®ä¿¡ç™»å½•æˆåŠŸï¼');

                    // æ·»åŠ æ¬¢è¿é€šçŸ¥
                    DataManager.addNotification({
                        icon: 'ğŸ‰',
                        title: 'å¾®ä¿¡ç™»å½•æˆåŠŸ',
                        content: 'æ¬¢è¿å›æ¥ï¼Œ' + (result.user.nickname || 'å¾®ä¿¡ç”¨æˆ·') + 'ï¼'
                    });
                } else {
                    showError(result.message || 'å¾®ä¿¡ç™»å½•å¤±è´¥');
                }
            }, 1500);
        }

        // æ›´æ–°ç™»å½•çŠ¶æ€UI
        function updateLoginState() {
            const user = DataManager.getCurrentUser();
            const isLogged = !!user;

            // æ›´æ–°æ‰€æœ‰å¤´åƒçš„ç™»å½•çŠ¶æ€æ ‡è®°
            document.querySelectorAll('.card-avatar, .profile-avatar-large, .portfolio-avatar, .photo-detail-avatar, .contact-avatar').forEach(avatar => {
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç™»å½•æ ‡è®°
                let badge = avatar.parentElement?.querySelector('.logged-in-badge');
                if (isLogged) {
                    if (!badge) {
                        badge = document.createElement('div');
                        badge.className = 'logged-in-badge';
                        badge.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
                        if (avatar.parentElement) {
                            avatar.parentElement.style.position = 'relative';
                            avatar.parentElement.appendChild(badge);
                        }
                    }
                } else {
                    if (badge) {
                        badge.remove();
                    }
                }
            });

            // æ›´æ–°æˆ‘çš„é¡µé¢æ˜¾ç¤º
            const nameEl = document.querySelector('.profile-name-large, .card-info h2, .portfolio-name');
            const bioEl = document.querySelector('.profile-bio, .card-signature, .portfolio-bio');

            if (isLogged && user) {
                if (nameEl) nameEl.textContent = user.nickname || 'ç”¨æˆ·';
                if (bioEl) bioEl.textContent = user.bio || '"ç”¨é•œå¤´è®°å½•ç¾å¥½ç¬é—´"';
            } else {
                // é»˜è®¤æ˜¾ç¤º
                if (nameEl && nameEl.textContent.includes('æ—æ‚¦') === false) {
                    nameEl.textContent = 'ç‚¹å‡»ç™»å½•';
                }
            }
        }

        // æ˜¾ç¤ºéšç§æ”¿ç­–
        function showPrivacyPolicy() {
            const content = `
                <div style="padding: 20px; line-height: 1.8; font-size: 14px;">
                    <h4 style="margin-bottom: 16px;">ç”¨æˆ·åè®®</h4>
                    <p style="margin-bottom: 12px;">æ¬¢è¿ä½¿ç”¨å…‰å½±ä½œå“é›†ï¼</p>
                    <p style="margin-bottom: 12px;">ä½¿ç”¨æœ¬æœåŠ¡å³è¡¨ç¤ºæ‚¨åŒæ„ä»¥ä¸‹æ¡æ¬¾ï¼š</p>
                    <ol style="padding-left: 20px; margin-bottom: 16px;">
                        <li style="margin-bottom: 8px;">æ‚¨ä¿è¯ä¸Šä¼ çš„å†…å®¹ä¸ä¾µçŠ¯ä»–äººç‰ˆæƒ</li>
                        <li style="margin-bottom: 8px;">æ‚¨çš„ä¸ªäººä¿¡æ¯ä»…ç”¨äºæä¾›æœåŠ¡</li>
                        <li style="margin-bottom: 8px;">ç¦æ­¢å‘å¸ƒè¿æ³•è¿è§„å†…å®¹</li>
                        <li>å¹³å°æœ‰æƒåœ¨æ³•å¾‹èŒƒå›´å†…ä½¿ç”¨æ‚¨çš„æ•°æ®</li>
                    </ol>
                    <h4 style="margin-bottom: 16px;">éšç§æ”¿ç­–</h4>
                    <p style="margin-bottom: 12px;">æˆ‘ä»¬é‡è§†æ‚¨çš„éšç§ï¼š</p>
                    <ol style="padding-left: 20px;">
                        <li style="margin-bottom: 8px;">æœ¬åœ°å­˜å‚¨ä»…ä¿å­˜æ‚¨çš„åå¥½è®¾ç½®</li>
                        <li style="margin-bottom: 8px;">ä½œå“æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</li>
                        <li style="margin-bottom: 8px;">æ‚¨å¯ä»¥éšæ—¶æ¸…é™¤æœ¬åœ°æ•°æ®</li>
                        <li>æˆ‘ä»¬ä¸ä¼šå‡ºå”®æ‚¨çš„ä¸ªäººä¿¡æ¯</li>
                    </ol>
                </div>
            `;
            openSettingsModal('ç”¨æˆ·åè®®ä¸éšç§æ”¿ç­–', content);
        }

        // æ˜¾ç¤ºç”¨æˆ·ä¸ªäººèµ„æ–™å¼¹å±‚
        function showUserProfile() {
            const user = DataManager.getCurrentUser();
            if (!user) {
                showLoginModal();
                return;
            }

            const content = `
                <div style="padding: 24px 16px;">
                    <!-- å¤´åƒ -->
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="position: relative; display: inline-block;">
                            <img src="${user.avatar || 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face'}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <div style="position: absolute; bottom: 0; right: 0; width: 24px; height: 24px; background: var(--success); border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center;">
                                <svg width="14" height="14" fill="white" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                            </div>
                        </div>
                        <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">${user.nickname || 'ç”¨æˆ·'}</h3>
                        <p style="font-size: 13px; color: var(--text-secondary);">${user.phone ? 'æ‰‹æœºç”¨æˆ·' : 'å¾®ä¿¡ç”¨æˆ·'}</p>
                    </div>

                    <!-- ç»Ÿè®¡ -->
                    <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 24px; padding: 16px; background: var(--bg); border-radius: 12px;">
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: 600;">${DataManager.getFavorites().length}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">æ”¶è—</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: 600;">${DataManager.getLikes() ? Object.values(DataManager.getLikes()).filter(Boolean).length : 0}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">ç‚¹èµ</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: 600;">${DataManager.getBrowsingHistory().length}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">æµè§ˆ</div>
                        </div>
                    </div>

                    <!-- èœå• -->
                    <div style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                        <div class="menu-item" onclick="showUserEdit()">
                            <div class="menu-icon">âœï¸</div>
                            <div class="menu-text">ç¼–è¾‘èµ„æ–™</div>
                            <div class="menu-arrow">â€º</div>
                        </div>
                        <div class="menu-item" onclick="showFavorites()">
                            <div class="menu-icon">â¤ï¸</div>
                            <div class="menu-text">æˆ‘çš„æ”¶è—</div>
                            <div class="menu-arrow">â€º</div>
                        </div>
                        <div class="menu-item" onclick="showBrowsingHistory()">
                            <div class="menu-icon">ğŸ“‹</div>
                            <div class="menu-text">æµè§ˆå†å²</div>
                            <div class="menu-arrow">â€º</div>
                        </div>
                        <div class="menu-item" onclick="showNotifications()">
                            <div class="menu-icon">ğŸ””</div>
                            <div class="menu-text">æ¶ˆæ¯é€šçŸ¥</div>
                            ${DataManager.getUnreadCount() > 0 ? `<span style="background: var(--danger); color: white; font-size: 11px; padding: 2px 8px; border-radius: 10px;">${DataManager.getUnreadCount()}</span>` : ''}
                            <div class="menu-arrow">â€º</div>
                        </div>
                    </div>

                    <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
                    <button onclick="logout()" style="width: 100%; margin-top: 24px; padding: 14px; background: var(--bg); border: none; border-radius: 12px; font-size: 15px; color: var(--danger); cursor: pointer;">é€€å‡ºç™»å½•</button>
                </div>
            `;

            document.getElementById('user-modal-content').innerHTML = content;
            document.getElementById('user-modal').classList.add('show');
        }

        // å…³é—­ç”¨æˆ·å¼¹å±‚
        function closeUserModal() {
            document.getElementById('user-modal').classList.remove('show');
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                DataManager.logout();
                closeUserModal();
                updateLoginState();
            }
        }

        // æ˜¾ç¤ºç¼–è¾‘èµ„æ–™
        function showUserEdit() {
            const user = DataManager.getCurrentUser();
            if (!user) {
                closeUserModal();
                showLoginModal();
                return;
            }

            const content = `
                <div style="padding: 20px 16px;">
                    <!-- å¤´åƒ -->
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="position: relative; display: inline-block;">
                            <img src="${user.avatar || 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=face'}" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;" onclick="changeAvatar()">
                            <div onclick="changeAvatar()" style="position: absolute; bottom: 0; right: 0; width: 28px; height: 28px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                <span style="font-size: 14px;">ğŸ“·</span>
                            </div>
                        </div>
                    </div>

                    <!-- è¡¨å• -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ˜µç§°</label>
                        <input type="text" id="edit-nickname" value="${user.nickname || ''}" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px;" placeholder="è¯·è¾“å…¥æ˜µç§°">
                    </div>

                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">ä¸ªäººç®€ä»‹</label>
                        <textarea id="edit-bio" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; min-height: 80px; resize: vertical;" placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±">${user.bio || ''}</textarea>
                    </div>

                    ${user.wechatOpenId ? '' : `
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">æ‰‹æœºå·</label>
                        <input type="tel" id="edit-phone" value="${user.phone || ''}" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px;" placeholder="è¯·è¾“å…¥æ‰‹æœºå·">
                    </div>
                    `}

                    <button onclick="saveUserEdit()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer;">ä¿å­˜</button>
                </div>
            `;

            closeUserModal();
            openSettingsModal('ç¼–è¾‘èµ„æ–™', content);
        }

        // ä¿å­˜ç”¨æˆ·ç¼–è¾‘
        function saveUserEdit() {
            const nickname = document.getElementById('edit-nickname')?.value?.trim();
            const bio = document.getElementById('edit-bio')?.value?.trim();
            const phone = document.getElementById('edit-phone')?.value?.trim();

            if (!nickname) {
                showToast('è¯·è¾“å…¥æ˜µç§°');
                return;
            }

            const updates = { nickname, bio };
            if (phone) {
                if (!Utils.validatePhone(phone)) {
                    showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
                    return;
                }
                updates.phone = phone;
            }

            const result = DataManager.updateUserProfile(updates);
            if (result.success) {
                currentUser = result.user;
                updateLoginState();
                closeSettingsModal();
                showSuccess('èµ„æ–™å·²æ›´æ–°');
            } else {
                showError(result.message || 'æ›´æ–°å¤±è´¥');
            }
        }

        // æ˜¾ç¤ºæ”¶è—
        function showFavorites() {
            const favorites = DataManager.getFavorites();
            closeUserModal();

            if (favorites.length === 0) {
                showToast('æš‚æ— æ”¶è—');
                return;
            }

            const portfolio = DataManager.getPortfolio();
            const favGroups = portfolio.filter(g => favorites.includes(g.id));

            if (favGroups.length === 0) {
                showToast('æ”¶è—çš„ä½œå“å·²åˆ é™¤');
                return;
            }

            const content = favGroups.map(group => `
                <div style="display: flex; gap: 12px; padding: 12px; border-bottom: 1px solid var(--border);" onclick="showPhotoDetail(${group.id}, ${group.photos[0]?.id})">
                    <img src="${group.photos[0]?.src}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 4px;">${group.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${group.style}</div>
                    </div>
                </div>
            `).join('');

            openSettingsModal('æˆ‘çš„æ”¶è—', `<div style="padding-bottom: 20px;">${content}</div>`);
        }

    </script>
</body>
</html>
