# 微信小程序部署上线指南

## 📋 部署前检查清单

### 1. 账号准备
- [ ] 已注册微信公众平台账号
- [ ] 已完成小程序主体认证
- [ ] 已获取 AppID

### 2. 基础信息配置
- [ ] 小程序名称: 光影作品集
- [ ] AppID: (请填写)
- [ ] 服务类目: 摄影服务
- [ ] 描述: 独立摄影师作品展示与预约平台

### 3. 资质要求
- [ ] 营业执照（企业/个体户）
- [ ]  ICP备案（非必须，根据类目）
- [ ] 摄影师资质证书（可选）

---

## 🔧 微信开发者工具配置

### 1. 下载安装
- 下载地址: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
- 安装最新稳定版本

### 2. 导入项目
1. 打开微信开发者工具
2. 点击「+」导入项目
3. 选择项目目录: `C:\Users\admin\photo-portfolio`
4. 填写 AppID（使用测试号或正式号）
5. 点击「确定」

### 3. 云开发配置
1. 点击「云开发」按钮
2. 点击「开通」创建环境
3. 选择「按量付费」或「免费版」
4. 创建成功后，获取环境ID
5. 编辑 `src/app.tsx`，替换环境ID:
```typescript
Taro.cloud.init({
  env: 'your-cloud-env-id'  // 替换为你的环境ID
})
```

### 4. 云函数部署
1. 在开发者工具中，右键点击 `cloudfunctions` 文件夹
2. 选择「上传并部署：云端安装依赖」
3. 等待部署完成

---

## 🗄️ 数据库配置

### 1. 创建集合
在云开发控制台 → 数据库，创建以下集合：

| 集合名称 | 权限 | 说明 |
|---------|------|------|
| works | 所有用户可读，创作者可写 | 作品集合 |
| bookings | 创作者可读写 | 预约集合 |
| favorites | 仅创建者可读写 | 收藏集合 |
| photographers | 所有用户可读 | 摄影师信息 |
| users | 仅创建者可读写 | 用户信息 |

### 2. 配置权限
推荐使用以下权限配置：

**works 集合:**
```json
{
  "read": true,
  "write": "doc._openid == auth.openid"
}
```

**bookings 集合:**
```json
{
  "read": "doc._openid == auth.openid || doc.photographerId == auth.openid",
  "write": "doc._openid == auth.openid || doc.photographerId == auth.openid"
}
```

### 3. 初始化数据
在数据库中初始化摄影师信息：

```json
{
  "_id": "default",
  "name": "光影诗人",
  "title": "独立摄影师",
  "location": "上海",
  "bio": "专注人像摄影5年，用镜头记录每一个动人瞬间。",
  "avatar": "https://images.unsplash.com/photo-1544005313-94ddf0286df2",
  "wechatId": "your_wechat_id",
  "phone": "138****8888",
  "stats": {
    "works": 128,
    "favorites": 2300,
    "bookings": 56
  }
}
```

---

## 🖼️ 存储桶配置

### 1. 创建存储桶
在云开发控制台 → 存储，创建存储桶：
- 名称: `photo-portfolio`
- 权限: 所有用户可读，仅创作者可写

### 2. 配置CDN
- 建议开启CDN加速
- 配置自定义域名（如有需要）

---

## 🔐 隐私合规检查

### 1. 用户隐私
- [ ] 已添加《用户隐私保护指引》
- [ ] 已配置收集用户信息声明
- [ ] 已添加隐私政策链接

### 2. 授权弹窗
检查 `project.config.json`：
```json
{
  "setting": {
    "urlCheck": true,
    "es6": true,
    "enhance": true
  }
}
```

### 3. 类目资质
根据实际类目，准备以下资质：
- 企业营业执照
- ICP备案（如有网站）
- 摄影师职业证书（如有）

---

## 📱 提审前准备

### 1. 截图准备
准备以下截图：
- [ ] 首页截图
- [ ] 作品详情截图
- [ ] 预约流程截图
- [ ] 个人中心截图

### 2. 功能说明
准备功能说明文档：
1. 首页展示摄影师作品
2. 用户可浏览作品并预约拍摄
3. 摄影师可管理预约状态
4. 支持微信支付（如有）

### 3. 测试账号
提供测试账号（如需要）：
- 账号: test
- 密码: test123

---

## 🚀 提交审核

### 1. 上传代码
1. 在微信开发者工具中，点击「上传」
2. 填写版本号: 1.0.0
3. 填写版本描述: 首次发布
4. 点击「确定」

### 2. 提交审核
1. 登录微信公众平台
2. 进入「版本管理」→「审核版本」
3. 点击「提交审核」
4. 填写审核信息：
   - 功能详细信息
   - 测试账号（如需要）
   - 截图

### 3. 审核时间
- 常规类目: 1-3个工作日
- 特殊类目: 3-7个工作日

---

## ✅ 发布上线

### 1. 审核通过
1. 收到审核通过通知
2. 在公众平台点击「发布」
3. 选择「全量发布」或「灰度发布」

### 2. 灰度发布（推荐）
- 先发布给10%用户
- 观察24小时
- 无问题后全量发布

### 3. 全量发布
- 所有用户可见
- 正式上线

---

## 🔧 常见问题

### Q1: 云函数部署失败
**解决方案：**
1. 检查网络连接
2. 确认云环境已开通
3. 删除 cloudfunctions 重新部署

### Q2: 数据库查询报错
**解决方案：**
1. 检查集合名称是否正确
2. 确认权限配置
3. 检查索引是否创建

### Q3: 图片加载失败
**解决方案：**
1. 检查存储桶权限
2. 确认图片URL正确
3. 检查域名配置

### Q4: 预约功能异常
**解决方案：**
1. 检查云函数日志
2. 确认数据库集合存在
3. 检查网络请求

---

## 📊 监控与维护

### 1. 数据监控
- 每日UV/PV统计
- 预约转化率
- 页面访问路径

### 2. 错误监控
- JS错误日志
- 云函数调用日志
- 接口错误监控

### 3. 版本迭代
- 定期收集用户反馈
- 每月功能更新
- 性能优化迭代

---

## 📞 技术支持

### 官方资源
- 微信文档: https://developers.weixin.qq.com/miniprogram/dev/framework/
- Taro文档: https://taro-docs.jd.com/
- 云开发文档: https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html

### 问题排查
1. 查看控制台错误日志
2. 检查网络请求
3. 确认配置信息
4. 搜索常见问题

---

## 📝 版本记录

### v1.0.0 (当前版本)
- 完成核心功能开发
- 首页作品展示
- 预约系统
- 个人中心
- 云开发集成

### 计划功能
- [ ] 在线支付
- [ ] 客户评价系统
- [ ] 价格表展示
- [ ] 拍摄须知页面
- [ ] 消息推送

---

**部署日期**: 2024年
**版本**: 1.0.0
**状态**: 待提交审核
